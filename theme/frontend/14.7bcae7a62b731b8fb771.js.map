{"version":3,"sources":["./src/app/modules/augmenting/dynamic-scripts/custom_fields.js"],"names":["window","$","length","format","lengthField","regexpField","multiSelect","possibleValues","defaultValueFields","spanDefaultText","spanDefaultLongText","spanDefaultBool","textOrientationField","deactivate","element","hide","find","not","attr","activate","show","removeAttr","toggleVisibility","method","args","fields","Array","prototype","slice","call","each","idx","field","closest","arguments","toggleFormat","searchable","unsearchable","val","on","trigger","change","lang","this","moveUpRow","row","prev","before","moveDownRow","next","after","moveRowToTheTop","jQuery","siblings","moveRowToTheBottom","last","removeOption","self","endsWith","remove","duplicateRow","count","dup","clone","value","defaultValue","prop","click","uncheckOtherDefaults","cb","i","other","checkOnlyOne","document","ready","container","getElementById","dragula","isContainer","el","moves","source","handle","sibling","hasClass","accepts","target","invalid","direction","copy","copySortSource","revertOnSpill","removeOnSpill","mirrorContainer","ignoreInputTextSelection"],"mappings":"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","file":"14.7bcae7a62b731b8fb771.js","sourcesContent":["//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2017 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n(function(window, $) {\n  /*\n   * @see /app/views/custom_fields/_form.html.erb\n   */\n  $(function() {\n    var customFieldForm = $('#custom_field_form');\n\n    if (customFieldForm.length === 0) {\n      return;\n    }\n\n    // collect the nodes involved\n    var format                = $('#custom_field_field_format'),\n        lengthField           = $('#custom_field_length'),\n        regexpField           = $('#custom_field_regexp'),\n        multiSelect           = $('#custom_field_multi_select'),\n        possibleValues        = $('#custom_field_possible_values_attributes'),\n        defaultValueFields    = $('#custom_field_default_value_attributes'),\n        spanDefaultText       = $('#default_value_text'),\n        spanDefaultLongText   = $('#default_value_long_text'),\n        spanDefaultBool       = $('#default_value_bool'),\n        textOrientationField  = $('#custom_field_text_orientation');\n\n    var deactivate = function(element) {\n      element.hide().find('input, textarea').not('.destroy_flag,.-cf-ignore-disabled').attr('disabled', true);\n    },\n    activate = function(element) {\n      element.show().find('input, textarea').not('.destroy_flag,.-cf-ignore-disabled').removeAttr('disabled');\n    },\n    toggleVisibility = function(method, args) {\n      var fields = Array.prototype.slice.call(args);\n      $.each(fields, function(idx, field) {\n        field.closest('.form--field, .form--grouping')[method]();\n      });\n    },\n    hide = function() { toggleVisibility('hide', arguments); },\n    show = function() { toggleVisibility('show', arguments); },\n    toggleFormat = function() {\n      var searchable   = $('#searchable_container'),\n          unsearchable = function() { searchable.attr('checked', false).hide(); };\n\n      // defaults (reset these fields before doing anything else)\n      $.each([spanDefaultBool, spanDefaultLongText, spanDefaultText, multiSelect, textOrientationField], function(idx, element) {\n        deactivate(element);\n      });\n      activate(defaultValueFields);\n      activate(spanDefaultText);\n\n      switch (format.val()) {\n        case 'list':\n          deactivate(defaultValueFields);\n          hide(lengthField, regexpField, defaultValueFields);\n          show(searchable, multiSelect);\n          activate(multiSelect);\n          activate(possibleValues);\n          break;\n        case 'bool':\n          activate(spanDefaultBool);\n          deactivate(spanDefaultText);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, searchable);\n          unsearchable();\n          break;\n        case 'date':\n          deactivate(defaultValueFields);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, defaultValueFields);\n          unsearchable();\n          break;\n        case 'float':\n        case 'int':\n          deactivate(possibleValues);\n          show(lengthField, regexpField);\n          unsearchable();\n          break;\n        case 'user':\n          show(multiSelect);\n          activate(multiSelect);\n        case 'version':\n          deactivate(defaultValueFields);\n          deactivate(possibleValues);\n          hide(lengthField, regexpField, defaultValueFields);\n          unsearchable();\n          break;\n        case 'text':\n          activate(spanDefaultLongText);\n          deactivate(spanDefaultText);\n          show(lengthField, regexpField, searchable, textOrientationField);\n          deactivate(possibleValues);\n          activate(textOrientationField);\n          break;\n        default:\n          show(lengthField, regexpField, searchable);\n          deactivate(possibleValues);\n          break;\n      }\n    };\n\n    // assign the switch format function to the select field\n    format.on('change', toggleFormat).trigger('change');\n    toggleFormat();\n  });\n\n  $(function() {\n    var localeSelectors = $('.locale_selector');\n\n    localeSelectors.change(function () {\n      var lang = $(this).val(),\n          span = $(this).closest('.translation');\n      span.attr('lang', lang);\n    }).trigger('change');\n  });\n\n  var moveUpRow = function() {\n    var row = $(this).closest(\"tr\");\n    var above = row.prev(\"tr\");\n\n    above.before(row);\n\n    return false;\n  };\n\n  var moveDownRow = function() {\n    var row = $(this).closest(\"tr\");\n    var after = row.next(\"tr\");\n\n    after.after(row);\n\n    return false;\n  };\n\n  var moveRowToTheTop = function() {\n    var row = $(this).closest(\"tr\");\n    var first = jQuery(row.siblings()[0]);\n\n    first.before(row);\n\n    return false;\n  };\n\n  var moveRowToTheBottom = function() {\n    var row = $(this).closest(\"tr\");\n    var last = jQuery(row.siblings().last()[0]);\n\n    last.after(row);\n\n    return false;\n  };\n\n  var removeOption = function() {\n    var self = $(this);\n    if (self.attr(\"href\") === \"#\" || self.attr(\"href\").endsWith(\"/0\")) {\n      var row = self.closest(\"tr\");\n\n      if (row.siblings().length > 1) {\n        row.remove();\n      }\n\n      return false; // just remove new element\n    } else {\n      return true; // send off deletion\n    }\n  };\n\n  var duplicateRow = function() {\n    var count = $(\"#custom-options-table tr.custom-option-row\").length;\n    var row = $(\"#custom-options-table tr.custom-option-row:last\");\n    var dup = row.clone();\n\n    var value = dup.find(\".custom-option-value input\");\n\n    value.attr(\"name\", \"custom_field[custom_options_attributes][\" + count + \"][value]\");\n    value.attr(\"id\", \"custom_field_custom_options_attributes_\" + count + \"_value\");\n    value.val(\"\");\n\n    var defaultValue = dup.find(\".custom-option-default-value\");\n\n    defaultValue.attr(\"name\", \"custom_field[custom_options_attributes][\" + count + \"][default_value]\");\n    defaultValue.prop(\"checked\", false);\n\n    dup.find(\".custom-option-id\").remove()\n\n    dup.find(\".move-up-custom-option\").click(moveUpRow);\n    dup.find(\".sort-up-custom-option\").click(moveRowToTheTop);\n    dup.find(\".sort-down-custom-option\").click(moveRowToTheBottom);\n    dup.find(\".move-down-custom-option\").click(moveDownRow);\n    dup.find(\".custom-option-default-value\").change(uncheckOtherDefaults);\n\n    dup\n      .find(\".delete-custom-option\")\n      .attr(\"href\", \"#\")\n      .click(removeOption);\n\n    row.after(dup);\n\n    return false;\n  };\n\n  var uncheckOtherDefaults = function() {\n    var cb = $(this);\n\n    if (cb.prop(\"checked\")) {\n      var multi = $('#custom_field_multi_value');\n\n      if (!multi.prop(\"checked\")) {\n        $(\".custom-option-default-value\").each(function(i, other) {\n          $(other).prop(\"checked\", false);\n        });\n\n        cb.prop(\"checked\", true);\n      }\n    }\n  };\n\n  var checkOnlyOne = function() {\n    var cb = $(this);\n\n    if (!cb.prop(\"checked\")) {\n      $(\".custom-option-default-value:checked\").slice(1).each(function(i, other) {\n        $(other).prop(\"checked\", false);\n      });\n    }\n  };\n\n  $(document).ready(function() {\n    $(\"#add-custom-option\").click(duplicateRow);\n    $(\".delete-custom-option\").click(removeOption);\n\n    $(\".move-up-custom-option\").click(moveUpRow);\n    $(\".move-down-custom-option\").click(moveDownRow);\n\n    $(\".sort-up-custom-option\").click(moveRowToTheTop);\n    $(\".sort-down-custom-option\").click(moveRowToTheBottom);\n\n    $(\".custom-option-default-value\").change(uncheckOtherDefaults);\n    $('#custom_field_multi_value').change(checkOnlyOne);\n\n    // Make custom fields draggable\n    var container = document.getElementById('custom-field-dragula-container');\n    dragula([container], {\n      isContainer: function (el) {\n        return false;\n      },\n      moves: function (el, source, handle, sibling) {\n        return $(handle).hasClass('dragula-handle');\n      },\n      accepts: function (el, target, source, sibling) {\n        return true;\n      },\n      invalid: function (el, handle) {\n        return false;\n      },\n      direction: 'vertical',\n      copy: false,\n      copySortSource: false,\n      revertOnSpill: true,\n      removeOnSpill: false,\n      mirrorContainer: container,\n      ignoreInputTextSelection: true\n    });\n  });\n}(window, jQuery));\n"],"sourceRoot":"webpack:///"}