{"version":3,"sources":["./src/app/modules/boards/board/inline-add/board-inline-add-autocompleter.html","./src/app/modules/boards/board/inline-add/board-inline-add-autocompleter.component.ts","./src/app/modules/boards/board/board-list/board-inline-create.service.ts","./src/app/modules/boards/board/board-list/board-list-menu.component.html","./src/app/modules/boards/board/board-list/board-list-menu.component.ts","./src/app/modules/boards/board/board-filter/board-filters.service.ts","./src/app/modules/boards/board/board-list/board-list-cross-selection.service.ts","./node_modules/rxjs/_esm2015/internal/operators/retry.js","./src/app/modules/boards/board/board-list/board-list.component.html","./src/app/modules/boards/board/board-list/board-list.component.ts","./src/app/modules/boards/board/configuration-modal/tabs/highlighting-tab.component.ts","./src/app/modules/boards/board/configuration-modal/tabs/highlighting-tab.component.html","./src/app/modules/boards/board/configuration-modal/board-configuration.service.ts","./src/app/modules/boards/board/board-actions/board-action.service.ts","./src/app/modules/boards/board/board-actions/cached-board-action.service.ts","./src/app/modules/boards/board/board-actions/status/status-board-header.html","./src/app/modules/boards/board/board-actions/status/status-board-header.component.ts","./src/app/modules/boards/board/board-actions/status/status-action.service.ts","./src/app/modules/boards/board/board-actions/version/version-board-header.html","./src/app/modules/boards/board/board-actions/version/version-board-header.component.ts","./src/app/modules/boards/board/board-actions/version/version-action.service.ts","./src/app/modules/common/active-window/active-window.service.ts","./src/app/modules/boards/board/query-updated/query-updated.service.ts","./src/app/modules/boards/board/board-actions/assignee/assignee-board-header.html","./src/app/modules/boards/board/board-actions/assignee/assignee-board-header.component.ts","./src/app/modules/boards/board/board-actions/assignee/assignee-action.service.ts","./src/app/modules/boards/board/board-actions/subproject/subproject-board-header.html","./src/app/modules/boards/board/board-actions/subproject/subproject-board-header.component.ts","./src/app/modules/boards/board/board-actions/subproject/subproject-action.service.ts","./src/app/modules/boards/board/board-actions/subtasks/subtasks-board-header.html","./src/app/modules/boards/board/board-actions/subtasks/subtasks-board-header.component.ts","./src/app/modules/boards/board/board-actions/subtasks/board-subtasks-action.service.ts","./src/app/modules/boards/boards-root/boards-root.component.ts","./src/app/modules/boards/board/configuration-modal/board-configuration.modal.html","./src/app/modules/boards/board/configuration-modal/board-configuration.modal.ts","./src/app/modules/boards/board/toolbar-menu/boards-toolbar-menu.directive.ts","./src/app/modules/boards/tile-view/tile-view.component.html","./src/app/modules/boards/tile-view/tile-view.component.ts","./src/app/modules/boards/new-board-modal/new-board-modal.component.ts","./src/app/modules/boards/new-board-modal/new-board-modal.html","./src/app/modules/boards/index-page/boards-index-page.component.html","./src/app/modules/boards/index-page/boards-index-page.component.ts","./src/app/modules/boards/board-constants.const.ts","./src/app/modules/boards/board/add-list-modal/add-list-modal.html","./src/app/modules/boards/board/add-list-modal/add-list-modal.component.ts","./src/app/modules/boards/board/add-card-dropdown/add-card-dropdown-menu.directive.ts","./src/app/modules/boards/board/board-filter/board-filter.component.ts","./src/app/modules/boards/board/board-filter/board-filter.component.html","./node_modules/cdk-drag-scroll/__ivy_ngcc__/fesm2015/cdk-drag-scroll.js","./src/app/modules/boards/board/toolbar-menu/boards-menu-button.component.ts","./src/app/helpers/rxjs/request-switchmap.ts","./node_modules/rxjs/_esm2015/internal/operators/finalize.js","./src/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html","./src/app/modules/boards/board/board-partitioned-page/board-partitioned-page.component.ts","./src/app/modules/boards/board/board-partitioned-page/board-list-container.component.html","./src/app/modules/boards/board/board-partitioned-page/board-list-container.component.ts","./src/app/modules/boards/openproject-boards.routes.ts","./src/app/modules/boards/openproject-boards.module.ts"],"names":["querySpace","pathHelper","apiV3Service","urlParamsHelper","notificationService","CurrentProject","halResourceService","schemaCacheService","cdRef","I18n","wpCardDragDrop","text","placeholder","this","t","appendToContainer","onCancel","onReferenced","isLoading","searchInput$","Subject","results$","pipe","debounceTime","distinctUntilChanged","tap","switchMap","queryString","autocompleteWorkPackages","ngSelectComponent","open","setTimeout","focus","removeReferenceWorkPackageForm","emit","workPackage","ensureLoaded","then","close","component","dropdownPanel","_updatePosition","searchString","length","of","filters","results","value","add","elements","map","wp","id","query","currentFilters","buildV3GetFilters","merge","withOptionalProject","work_packages","filtered","get","collection","catchError","error","handleRawError","opened","cancel","addWorkPackageToQuery","injector","pathHelperService","Gon","wpRelationsHierarchyService","super","referenceComponentClass","referenceTarget","buttonTexts","reference","create","authorisationService","can","opModalService","boardService","boardActionRegistry","onRemove","items","disabled","canDelete","linkText","onClick","board","isAction","additional","actionService","getAdditionalListMenuItems","concat","actionAttribute","canManage","delete","getValueOr","selections$","selection","next","withinQuery","RetryOperator","count","source","subscriber","subscribe","Subscriber","destination","err","isStopped","_unsubscribeAndRecycle","apiv3Service","state","transitions","boardFilters","notifications","halNotification","halEvents","wpStatesInitialization","wpViewFocusService","wpViewSelectionService","boardListCrossSelectionService","wpInlineCreate","halEditing","loadingIndicator","schemaCache","causedUpdates","$state","actionResourceClass","showAddButton","addCard","updateSuccessful","areYouSure","unnamed_list","click_to_remove","canDragInto","initiallyFocused","workPackageAddedHandler","addWorkPackage","canDragOutOf","canDragOutOfHandler","canMove","resource","isNewWidget","includes","current","data","baseRoute","wpId","params","workPackageId","initializeSelection","observeUntil","canAdd","canReference","detectChanges","updates$","untilDestroyed","selectionState","selected","Object","keys","_","pickBy","focused","focusedWorkPackage","updateSelection","queryId","allSelected","selectionsForQuery","values$","updateQuery","listenToActionAttributeChanges","updateOrderedWorkPackages","loadActionAttribute","ngOnDestroy","error_message","loadingError","updateImmediately","isFree","cardView","setReferenceMode","addNewCard","window","confirm","queries","inFlight","name","patch","addSuccess","_error","attribute","backgroundClass","showStatusButton","visibly","setQueryProps","loadQuery","actionResource","undefined","headerComponent","getActionValueId","href","getLoadedActionValue","buttonPlaceholder","disabledAddButtonPlaceholder","boardListActionColorClass","dragIntoAllowed","canWriteAttribute","canAddToQuery","changeset","changeFor","assignToWorkPackage","isEmpty","cache","updateWorkPackage","save","options","toString","observable","find","columnsQueryProps","lift","retry","indicatorInstance","updateQuerySpace","retrieveErrorMessage","indicator","jQuery","nativeElement","newFilters","newColumnsQueryProps","JSON","stringify","events$","event","resourceType","eventType","commit","changes","filterName","to","from","double","go","requestedState","provide","useClass","BoardHighlightingTabComponent","locals","highlightingMode","entireCardMode","lastEntireCardAttribute","highlighting_mode","description","none","type","priority","entire_card_by","updateMode","mode","indexOf","_tabs","title","componentClass","boardListsService","currentProject","getHref","filter","getActionFilter","values","require","Promise","resolve","newBoard","operator","idFromLink","addQuery","active","matching","loadValues","item","has","hasMember","fieldSchema","writable","isWritable","Error","humanName","applyDefaultsFromFilters","putFromPromiseIfPristine","loadUncached","take","newValue","putValue","addColumnWithActionAttribute","toPromise","StatusBoardHeaderComponent","status","label","icon","image","imagePath","all","isDefault","statuses","VersionBoardHeaderComponent","isLocked","isClosed","version","writable$","createWorkPackage","form","schema","definingName","isOpen","buildItemsForVersion","projects","versions","newStatus","reload","hidden","$links","update","patchVersionStatus","versionShowPath","evt","isClickedWithModifier","versionEditPath","document","activeState$","BehaviorSubject","addEventListener","visibilityState","asObservable","activeWindow","ids","time","Date","interval","startWith","isActive","result","queryForUpdates","updatedAfter","list","toISOString","AssigneeBoardHeaderComponent","assignee","unassignedUser","project","memberships","link","projectMembershipsPath","identifier","available_assignees","SubprojectBoardHeaderComponent","move","setValue","currentProjectId","typeHighlightingClass","inlineClass","changeParent","registry","boardConfigurationService","appRef","componentFactoryResolver","elementRef","closeOnEscape","closeOnOutsideClick","closePopup","applyButton","cancelButton","$element","tabPortalHost","tabs","tabContentOutlet","initialTab","availableTabs","switchTo","dispose","currentTab","activeComponents","forEach","onSave","service","afterFocusOn","closeMe","saveChanges","opContextMenu","Notifications","State","deleteSuccessful","contextMenuId","buildItems","show","$event","grid","trigger","flash_message","message","disable","boardActions","loadingIndicatorService","showClose","confirmed","available","close_popup","free_board","free_board_text","free_board_title","board_type","action_board","action_board_text","select_attribute","select_board_type","initiateTiles","createFree","createAction","unshift","addIcon","addDescription","addText","addImage","modal","promise","board_id","isNew","catch","tiles","element","createBoard","bannerService","domSanitizer","boards","type_free","action_by_attribute","attr","createdAt","noResults","teaser_text","enterprise","upgrade","personal_demo","boards$","observeAll","teaserVideoURL","bypassSecurityTrustResourceUrl","loadAllBoards","addError","eeShowBanners","requests","searchTerm","loadAvailable","trackByHref","button_add","button_cancel","referenceOutputs","onCreate","onNewActionCreated","onOpen","input$","onChange","onModelChange","onAfterViewInit","focusInputField","showWarning","ngOnInit","Set","output$","lastRequestedValue","warningTextWhenNoOptionsAvailable","warningText","availableValues","selectedAttribute","autocompleterComponent","boardList","focusAfterClose","position","positionArgs","assign","my","at","addReferenceCard","currentProjectService","wpTableFilters","initialized","board$","loadQueryForm","updateChecksumOnFilterChanges","push","live$","skip","filterHash","query_props","custom","notify","loadWithParams","updateStatesFromForm","AutoScroll","container","scrollCallback","margin","maxSpeed","point","x","y","boundaryRect","getBoundingClientRect","cancelAnimationFrame","animationFrame","requestAnimationFrame","scrollTick","autoScroll","scrollx","scrolly","left","Math","floor","max","right","ceil","min","top","bottom","scrollY","scrollX","amount","scrollTop","scrollLeft","debugInfo","enabled","info","ɵfac","ɵprov","token","factory","providedIn","ctorParameters","ngInjectableDef","cdkDrag","dragDebugService","zone","changeDetectorRef","destroy$","stopDragging$","lastScroll","dragRef","runOutsideAngular","started","takeUntil","log","isDragging","ended","entered","exited","dragConnectedIds","syncSiblings","complete","destroyAutoScroll","scrollContainer","addDebugInfo","fromEvent","deltaX","deltaY","handleScroll","moved","e","onMove","pointerPosition","reset","dragFixContainer","dropListRef","getDropListRef","adjustContainers","adjustItems","_draggables","_itemPositions","syncItems","destroy","draws","it","clientRect","color","drag","_siblings","_clientRect","d","_cacheOwnPosition","markForCheck","beforeStarted","oldPositions","_activeDraggables","slice","_cacheItemPositions","newPositions","p","p1","sibling","originalRect","optionalParams","console","ɵdir","selectors","inputs","exportAs","features","propDecorators","args","DragScrollModule","ɵmod","ɵinj","imports","BoardsMenuButtonComponent","button_more","handler","responses$","until","FinallyOperator","callback","Subscription","$transitions","Boards","unnamedBoard","addList","upsaleBoards","upsaleCheckOutLink","observe","backButtonCallback","toolbarDisabled","showToolbar","filterAllowed","currentPartition","filterContainerDefinition","boardSaver","toolbarButtonComponents","containerClasses","editable","removeTransitionSubscription","onSuccess","transition","toState","showToolbarSaveButton","setPartition","queryProps","selectedTitle","parse","newName","request","val","changeChangesFromTitle","partition","updateTitleName","boardComponent","BoardList","Banner","Drag","QueryUpdated","trackByQueryId","index","widget","v","_container","addScrollContainer","requireAndStream","currentBoard$","setupQueryUpdatedMonitoring","selections","previousIndex","currentIndex","saveBoard","removeQuery","addFreeQuery","showError","getActionFiltersFromWidget","currentQueryUpdatedMonitoring","unsubscribe","monitor","requestRefreshOfUpdatedLists","lists","listComponent","refreshQueryUnlessCaused","widgets","menuItemClass","BOARDS_ROUTES","parent","url","bodyClasses","menuItem","dynamic","redirectTo","inherit","reloadOnSearch","views","OpenprojectBoardsModule","withComponents","forChild","states","config","uiRouter","urlService","rules","when","RegExp","match"],"mappings":"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","file":"boards-openproject-boards-module.1b97dc35822f9a88975b.js","sourcesContent":["<ng-select ngClass=\"wp-inline-create--reference-autocompleter\"\n           [items]=\"results$ | async\"\n           [appendTo]=\"appendToContainer\"\n           [multiple]=\"false\"\n           [loading]=\"isLoading\"\n           [typeahead]=\"searchInput$\"\n           [closeOnSelect]=\"false\"\n           (open)=\"opened()\"\n           (close)=\"cancel()\"\n           (change)=\"addWorkPackageToQuery($event)\">\n  <ng-template ng-label-tmp let-item=\"item\">\n    {{item.type.name }} #{{ item.id }} {{ item.subject }}\n  </ng-template>\n  <ng-template ng-option-tmp let-item=\"item\" let-index=\"index\" let-search=\"searchTerm\">\n    {{item.type.name }} #{{ item.id }} {{ item.subject }}\n  </ng-template>\n</ng-select>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {\n  AfterViewInit,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  Input,\n  Output,\n  ViewChild,\n  ViewEncapsulation\n} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {Observable, of, Subject} from \"rxjs\";\nimport {catchError, debounceTime, distinctUntilChanged, map, switchMap, tap} from \"rxjs/operators\";\nimport {NgSelectComponent} from \"@ng-select/ng-select\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {WorkPackageCollectionResource} from \"core-app/modules/hal/resources/wp-collection-resource\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {WorkPackageCardDragAndDropService} from \"core-components/wp-card-view/services/wp-card-drag-and-drop.service\";\nimport {WorkPackageNotificationService} from \"core-app/modules/work_packages/notifications/work-package-notification.service\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\n@Component({\n  selector: 'board-inline-add-autocompleter',\n  templateUrl: './board-inline-add-autocompleter.html',\n\n  // Allow styling the embedded ng-select\n  encapsulation: ViewEncapsulation.None,\n  styleUrls: ['./board-inline-add-autocompleter.sass']\n})\nexport class BoardInlineAddAutocompleterComponent implements AfterViewInit {\n  readonly text = {\n    placeholder: this.I18n.t('js.relations_autocomplete.placeholder')\n  };\n\n  @Input() appendToContainer:string = 'body';\n  @ViewChild(NgSelectComponent) public ngSelectComponent:NgSelectComponent;\n\n  @Output() onCancel = new EventEmitter<undefined>();\n  @Output() onReferenced = new EventEmitter<WorkPackageResource>();\n\n  // Whether we're currently loading\n  public isLoading = false;\n\n  // Search input from ng-select\n  public searchInput$ = new Subject<string>();\n\n  // Search results mapped to input\n  public results$:Observable<WorkPackageResource[]> = this.searchInput$.pipe(\n    debounceTime(250),\n    distinctUntilChanged(),\n    tap(() => this.isLoading = true),\n    switchMap(queryString => this.autocompleteWorkPackages(queryString))\n  );\n\n  constructor(private readonly querySpace:IsolatedQuerySpace,\n              private readonly pathHelper:PathHelperService,\n              private readonly apiV3Service:APIV3Service,\n              private readonly urlParamsHelper:UrlParamsHelperService,\n              private readonly notificationService:WorkPackageNotificationService,\n              private readonly CurrentProject:CurrentProjectService,\n              private readonly halResourceService:HalResourceService,\n              private readonly schemaCacheService:SchemaCacheService,\n              private readonly cdRef:ChangeDetectorRef,\n              private readonly I18n:I18nService,\n              private readonly wpCardDragDrop:WorkPackageCardDragAndDropService) {\n  }\n\n  ngAfterViewInit():void {\n    if (!this.ngSelectComponent) {\n      return;\n    }\n    this.ngSelectComponent.open();\n\n    setTimeout(() => {\n      this.ngSelectComponent.focus();\n    }, 25);\n\n    this.wpCardDragDrop.removeReferenceWorkPackageForm();\n  }\n\n  cancel() {\n    this.onCancel.emit();\n  }\n\n  public addWorkPackageToQuery(workPackage?:WorkPackageResource) {\n    if (workPackage) {\n      this.schemaCacheService\n        .ensureLoaded(workPackage)\n        .then(() => {\n          this.onReferenced.emit(workPackage);\n          this.ngSelectComponent.close();\n        });\n    }\n  }\n\n  public opened() {\n    // Force reposition as a workaround for BUG\n    // https://github.com/ng-select/ng-select/issues/1259\n    setTimeout(() => {\n      const component = this.ngSelectComponent as any;\n      if (component && component.dropdownPanel) {\n        component.dropdownPanel._updatePosition();\n      }\n    }, 25);\n  }\n\n  private autocompleteWorkPackages(searchString:string):Observable<WorkPackageResource[]> {\n    // Return when the search string is empty\n    if (searchString.length === 0) {\n      this.isLoading = false;\n      return of([]);\n    }\n\n    const filters:ApiV3FilterBuilder = new ApiV3FilterBuilder();\n    const results = this.querySpace.results.value;\n\n    filters.add('subjectOrId', '**', [searchString]);\n\n    if (results && results.elements.length > 0) {\n      filters.add('id', '!', results.elements.map((wp:WorkPackageResource) => wp.id!));\n    }\n\n    // Add the subproject filter, if any\n    const query = this.querySpace.query.value;\n    if (query?.filters) {\n      const currentFilters = this.urlParamsHelper.buildV3GetFilters(query.filters);\n      filters.merge(currentFilters, 'subprojectId');\n    }\n\n    return this\n      .apiV3Service\n      .withOptionalProject(this.CurrentProject.id)\n      .work_packages\n      .filtered(filters)\n      .get()\n      .pipe(\n        map(collection => collection.elements),\n        catchError((error:unknown) => {\n          this.notificationService.handleRawError(error);\n          return of([]);\n        }),\n        tap(() => this.isLoading = false)\n      );\n  }\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Injectable, Injector} from '@angular/core';\nimport {WorkPackageResource} from 'core-app/modules/hal/resources/work-package-resource';\nimport {WorkPackageRelationsHierarchyService} from \"core-components/wp-relations/wp-relations-hierarchy/wp-relations-hierarchy.service\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {BoardInlineAddAutocompleterComponent} from \"core-app/modules/boards/board/inline-add/board-inline-add-autocompleter.component\";\nimport {GonService} from \"core-app/modules/common/gon/gon.service\";\n\n@Injectable()\nexport class BoardInlineCreateService extends WorkPackageInlineCreateService {\n\n  constructor(readonly injector:Injector,\n              protected readonly querySpace:IsolatedQuerySpace,\n              protected readonly halResourceService:HalResourceService,\n              protected readonly pathHelperService:PathHelperService,\n              protected readonly Gon:GonService,\n              protected readonly wpRelationsHierarchyService:WorkPackageRelationsHierarchyService) {\n    super(injector);\n  }\n\n  /**\n   * A separate reference pane for the inline create component\n   */\n  public readonly referenceComponentClass = BoardInlineAddAutocompleterComponent;\n\n  /**\n   * A related work package for the inline create context\n   */\n  public referenceTarget:WorkPackageResource|null = null;\n\n  public get canAdd() {\n    return this.authorisationService.can('work_packages', 'createWorkPackage');\n  }\n\n  public get canReference() {\n    return this.authorisationService.can('work_packages', 'editWorkPackage');\n  }\n\n  /**\n   * Reference button text\n   */\n  public readonly buttonTexts = {\n    reference: this.I18n.t('js.relation_buttons.add_existing_child'),\n    create: this.I18n.t('js.relation_buttons.add_new_child')\n  };\n}\n","<ng-container class=\"board-list--more-menu\" *ngIf=\"canDelete()\">\n  <icon-triggered-context-menu\n     [menu-items]=\"menuItems\">\n  </icon-triggered-context-menu>\n</ng-container>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Component, Output, EventEmitter, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\n\n@Component({\n  selector: 'board-list-menu',\n  templateUrl: './board-list-menu.component.html',\n})\nexport class BoardListMenuComponent {\n  @Input() board:Board;\n  @Output() onRemove = new EventEmitter<void>();\n\n  constructor(readonly opModalService:OpModalService,\n              readonly authorisationService:AuthorisationService,\n              private readonly querySpace:IsolatedQuerySpace,\n              private readonly boardService:BoardService,\n              private readonly boardActionRegistry:BoardActionsRegistryService,\n              readonly I18n:I18nService) {\n  }\n\n  public get menuItems() {\n    return async () => {\n      let items:OpContextMenuItem[] = [\n        {\n          disabled: !this.canDelete,\n          linkText: this.I18n.t('js.boards.lists.delete'),\n          onClick: () => {\n            this.onRemove.emit();\n            return true;\n          }\n        }\n      ];\n\n      // Add action specific menu entries\n      if (this.board.isAction) {\n        const additional = await this.actionService.getAdditionalListMenuItems(this.query);\n        return items.concat(additional);\n      }\n\n      return items;\n    };\n  }\n\n  private get actionService():BoardActionService {\n    return this.boardActionRegistry.get(this.board.actionAttribute!);\n  }\n\n  private get canManage() {\n    return this.boardService.canManage(this.board);\n  }\n\n  public canDelete() {\n    return this.canManage && !!this.query.delete;\n  }\n\n  private get query() {\n    return this.querySpace.query.value!;\n  }\n}\n","import {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {input} from \"reactivestates\";\nimport { Injectable } from \"@angular/core\";\n\n@Injectable()\nexport class BoardFiltersService {\n  /**\n   * We need to remember the current filter, that may either come\n   * from the saved board, or were assigned by the user.\n   *\n   * This is due to the fact we do not work on an query object here.\n   */\n  filters = input<ApiV3Filter[]>([]);\n\n  get current():ApiV3Filter[] {\n    return this.filters.getValueOr([]);\n  }\n}","import {Observable, Subject} from \"rxjs\";\nimport {filter} from \"rxjs/operators\";\nimport { Injectable } from \"@angular/core\";\n\nexport interface BoardSelection {\n  /** The query that the selection happened in */\n  withinQuery:string;\n\n  /** The focused selected work package */\n  focusedWorkPackage:string|null;\n\n  /** Array of selected work packages */\n  allSelected:string[];\n}\n\n\n/**\n * Responsible for keeping selected items across all lists of a board,\n * selections in one list will propagate to other lists as well.\n */\n@Injectable()\nexport class BoardListCrossSelectionService {\n\n  private selections$ = new Subject<BoardSelection>();\n\n  /**\n   * Marks the selection of one or multiple cards within a list\n   * by a user.\n   *\n   * The primary selected should be open in split screen (if open).\n   *\n   */\n  updateSelection(selection:BoardSelection) {\n    this.selections$.next(selection);\n  }\n\n  /**\n   * Returns an observable for a given query that fires\n   * when its selection should be updated.\n   *\n   * @param id\n   */\n  selectionsForQuery(id:string):Observable<BoardSelection> {\n    return this\n      .selections$\n      .pipe(\n        filter(selection => selection.withinQuery !== id)\n      );\n  }\n\n  selections():Observable<BoardSelection> {\n    return this.selections$;\n  }\n}","import { Subscriber } from '../Subscriber';\nexport function retry(count = -1) {\n    return (source) => source.lift(new RetryOperator(count, source));\n}\nclass RetryOperator {\n    constructor(count, source) {\n        this.count = count;\n        this.source = source;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new RetrySubscriber(subscriber, this.count, this.source));\n    }\n}\nclass RetrySubscriber extends Subscriber {\n    constructor(destination, count, source) {\n        super(destination);\n        this.count = count;\n        this.source = source;\n    }\n    error(err) {\n        if (!this.isStopped) {\n            const { source, count } = this;\n            if (count === 0) {\n                return super.error(err);\n            }\n            else if (count > -1) {\n                this.count = count - 1;\n            }\n            source.subscribe(this._unsubscribeAndRecycle());\n        }\n    }\n}\n//# sourceMappingURL=retry.js.map","<div #loadingIndicator\n     [attr.data-query-name]=\"listName\"\n     class=\"board-list--container loading-indicator--location\"\n     [ngClass]=\"{ '-action-list': board.isAction }\">\n  <ng-container *ngIf=\"query\">\n\n    <div *ngIf=\"board.isAction\"\n         class=\"board-list--action-bar\"\n         [ngClass]=\"actionResourceClass\">\n    </div>\n\n    <div class=\"board-list--header\">\n      <ndc-dynamic *ngIf=\"headerComponent\"\n                   [ndcDynamicComponent]=\"headerComponent\"\n                   [ndcDynamicInputs]=\"{ resource: actionResource }\">\n      </ndc-dynamic>\n      <editable-toolbar-title *ngIf=\"!headerComponent\"\n                              [title]=\"query.name\"\n                              [smallHeader]=\"true\"\n                              [inFlight]=\"inFlight\"\n                              (onSave)=\"renameQuery(query, $event)\"\n                              [editable]=\"canRename\"\n                              [initialFocus]=\"initiallyFocused\"\n                              class=\"-small\">\n      </editable-toolbar-title>\n\n      <board-list-menu class=\"board-list--menu\"\n                       [board]=\"board\"\n                       (onRemove)=\"deleteList()\">\n      </board-list-menu>\n    </div>\n\n    <div class=\"board-list--query-container drop-zone\"\n         [ngClass]=\"{ '-with-create-button': board.isAction || showAddButton }\">\n      <div class=\"board-list--button-container\">\n        <button [title]=\"text.addCard\"\n                *ngIf=\"showAddButton\"\n                class=\"board-list--add-button board-list--card-dropdown-button button\"\n                addCardDropdown>\n          <op-icon icon-classes=\"icon-small icon-add\"></op-icon>\n        </button>\n      </div>\n\n      <wp-card-view [dragOutOfHandler]=\"canDragOutOfHandler\"\n                    [dragInto]=\"canDragInto\"\n                    [workPackageAddedHandler]=\"workPackageAddedHandler\"\n                    [cardsRemovable]=\"board.isFree && canDragOutOf\"\n                    [showInfoButton]=\"true\"\n                    [highlightingMode]=\"board.highlightingMode\"\n                    [showStatusButton]=\"showCardStatusButton()\"\n                    (itemClicked)=\"openFullViewOnDoubleClick($event)\"\n                    (stateLinkClicked)=\"openStateLink($event)\">\n\n      </wp-card-view>\n    </div>\n  </ng-container>\n  <div class=\"notification-box -error\" *ngIf=\"loadingError\">\n    <p>\n      <span [textContent]=\"errorMessage\"></span>\n      &ngsp;\n      <a role=\"button\" (accessibleClick)=\"onRemove.emit()\">\n        <span [textContent]=\"text.click_to_remove\"></span>\n      </a>\n    </p>\n  </div>\n</div>\n","import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Injector,\n  Input,\n  OnDestroy,\n  OnInit,\n  Output,\n  ViewChild\n} from \"@angular/core\";\nimport {\n  LoadingIndicatorService,\n  withLoadingIndicator\n} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {BoardInlineCreateService} from \"core-app/modules/boards/board/board-list/board-inline-create.service\";\nimport {AbstractWidgetComponent} from \"core-app/modules/grids/widgets/abstract-widget.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\nimport {WorkPackageCardViewComponent} from \"core-components/wp-card-view/wp-card-view.component\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {BoardService} from \"app/modules/boards/board/board.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {HalResourceEditingService} from \"core-app/modules/fields/edit/services/hal-resource-editing.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {CausedUpdatesService} from \"core-app/modules/boards/board/caused-updates/caused-updates.service\";\nimport {BoardListMenuComponent} from \"core-app/modules/boards/board/board-list/board-list-menu.component\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\nimport {WorkPackageCardDragAndDropService} from \"core-components/wp-card-view/services/wp-card-drag-and-drop.service\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {BoardFiltersService} from \"core-app/modules/boards/board/board-filter/board-filters.service\";\nimport {StateService, TransitionService} from \"@uirouter/core\";\nimport {WorkPackageViewFocusService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-focus.service\";\nimport {WorkPackageViewSelectionService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-selection.service\";\nimport {BoardListCrossSelectionService} from \"core-app/modules/boards/board/board-list/board-list-cross-selection.service\";\nimport {debounceTime, filter, map, retry} from \"rxjs/operators\";\nimport {HalEvent, HalEventsService} from \"core-app/modules/hal/services/hal-events.service\";\nimport {ChangeItem} from \"core-app/modules/fields/changeset/changeset\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\nexport interface DisabledButtonPlaceholder {\n  text:string;\n  icon:string;\n}\n\n@Component({\n  selector: 'board-list',\n  templateUrl: './board-list.component.html',\n  styleUrls: ['./board-list.component.sass'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    { provide: WorkPackageInlineCreateService, useClass: BoardInlineCreateService },\n    BoardListMenuComponent,\n    WorkPackageCardDragAndDropService\n  ]\n})\nexport class BoardListComponent extends AbstractWidgetComponent implements OnInit, OnDestroy {\n  /** Output fired upon query removal */\n  @Output() onRemove = new EventEmitter<void>();\n\n  /** Access to the board resource */\n  @Input() public board:Board;\n\n  /** Access to the loading indicator element */\n  @ViewChild('loadingIndicator', { static: true }) indicator:ElementRef;\n\n  /** Access to the card view */\n  @ViewChild(WorkPackageCardViewComponent) cardView:WorkPackageCardViewComponent;\n\n  /** The query resource being loaded */\n  public query:QueryResource;\n\n  /** Query loading error, if present */\n  public loadingError:string|undefined;\n\n  /** The action attribute resource if any */\n  public actionResource:HalResource|undefined;\n  public actionResourceClass:string = '';\n  public headerComponent:ComponentType<unknown>|undefined;\n\n  /** Rename inFlight */\n  public inFlight:boolean;\n\n  /** Whether the add button should be shown */\n  public showAddButton = false;\n\n  public columnsQueryProps:any;\n\n  public text = {\n    addCard: this.I18n.t('js.boards.add_card'),\n    updateSuccessful: this.I18n.t('js.notice_successful_update'),\n    areYouSure: this.I18n.t('js.text_are_you_sure'),\n    unnamed_list: this.I18n.t('js.boards.label_unnamed_list'),\n    click_to_remove: this.I18n.t('js.boards.click_to_remove_list')\n  };\n\n  /** Are we allowed to remove and drag & drop elements ? */\n  public canDragInto:boolean = false;\n\n  /** Initially focus the list */\n  public initiallyFocused:boolean = false;\n\n  /** Editing handler to be passed into card component */\n  public workPackageAddedHandler = (workPackage:WorkPackageResource) => this.addWorkPackage(workPackage);\n\n  /** Move check to be passed into card component */\n  public canDragOutOf:boolean = false;\n  public canDragOutOfHandler = (workPackage:WorkPackageResource) => this.canMove(workPackage);\n\n  public buttonPlaceholder:DisabledButtonPlaceholder|undefined;\n\n  constructor(readonly apiv3Service:APIV3Service,\n              readonly I18n:I18nService,\n              readonly state:StateService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly transitions:TransitionService,\n              readonly boardFilters:BoardFiltersService,\n              readonly notifications:NotificationsService,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly halNotification:HalResourceNotificationService,\n              readonly halEvents:HalEventsService,\n              readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              readonly wpViewFocusService:WorkPackageViewFocusService,\n              readonly wpViewSelectionService:WorkPackageViewSelectionService,\n              readonly boardListCrossSelectionService:BoardListCrossSelectionService,\n              readonly authorisationService:AuthorisationService,\n              readonly wpInlineCreate:WorkPackageInlineCreateService,\n              readonly injector:Injector,\n              readonly halEditing:HalResourceEditingService,\n              readonly loadingIndicator:LoadingIndicatorService,\n              readonly schemaCache:SchemaCacheService,\n              readonly boardService:BoardService,\n              readonly boardActionRegistry:BoardActionsRegistryService,\n              readonly causedUpdates:CausedUpdatesService,\n              readonly $state:StateService) {\n    super(I18n, injector);\n  }\n\n  ngOnInit():void {\n    // Unset the isNew flag\n    this.initiallyFocused = this.resource.isNewWidget;\n    this.resource.isNewWidget = false;\n\n    // Set initial selection if split view open\n    if (this.state.includes(this.state.current.data.baseRoute + '.details')) {\n      let wpId = this.state.params.workPackageId;\n      this.wpViewSelectionService.initializeSelection([wpId]);\n    }\n\n    // Update permission on model updates\n    this.authorisationService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        if (!this.board.isAction) {\n          this.showAddButton = this.canDragInto && (this.wpInlineCreate.canAdd || this.canReference);\n          this.cdRef.detectChanges();\n        }\n      });\n\n    // If this query space changes its focused or selected\n    // work packages, update the board cross selection\n    this.wpViewSelectionService\n      .updates$()\n      .pipe(\n        debounceTime(100),\n        this.untilDestroyed()\n      ).subscribe((selectionState) => {\n      let selected = Object.keys(_.pickBy(selectionState.selected, (selected, _) => selected === true));\n\n      const focused = this.wpViewFocusService.focusedWorkPackage;\n\n      this.boardListCrossSelectionService.updateSelection({\n        withinQuery: this.queryId,\n        focusedWorkPackage: focused,\n        allSelected: selected\n      });\n    });\n\n    // Apply focus and selection when changed in cross service\n    this.boardListCrossSelectionService\n      .selectionsForQuery(this.queryId)\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(selection => {\n        this.wpViewSelectionService.initializeSelection(selection.allSelected);\n      });\n\n    // Update query on filter change\n    this.boardFilters\n      .filters\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(() => this.updateQuery(true));\n\n    // Listen to changes to action attribute\n    this.listenToActionAttributeChanges();\n\n    this.querySpace.query\n      .values$()\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((query) => {\n        this.query = query;\n        this.canDragOutOf = !!this.query.updateOrderedWorkPackages;\n        this.loadActionAttribute(query);\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n  }\n\n  public get errorMessage() {\n    return this.I18n.t('js.boards.error_loading_the_list', { error_message: this.loadingError });\n  }\n\n  public canMove(workPackage:WorkPackageResource) {\n    return this.canDragOutOf && (!this.actionService || this.actionService.canMove(workPackage));\n  }\n\n  public get canReference() {\n    return this.wpInlineCreate.canReference;\n  }\n\n  public get canManage() {\n    return this.boardService.canManage(this.board);\n  }\n\n  public get canRename() {\n    return this.canManage &&\n      !!this.query.updateImmediately &&\n      this.board.isFree;\n  }\n\n  public addReferenceCard() {\n    this.cardView.setReferenceMode(true);\n  }\n\n  public addNewCard() {\n    this.cardView.addNewCard();\n  }\n\n  public deleteList(query?:QueryResource) {\n    query = query ? query : this.query;\n\n    if (!window.confirm(this.text.areYouSure)) {\n      return;\n    }\n\n    this\n      .apiv3Service\n      .queries\n      .id(query)\n      .delete()\n      .subscribe(() => this.onRemove.emit());\n  }\n\n  public renameQuery(query:QueryResource, value:string) {\n    this.inFlight = true;\n    this.query.name = value;\n    this\n      .apiv3Service\n      .queries\n      .id(this.query)\n      .patch({ name: value })\n      .subscribe(\n        () => {\n          this.inFlight = false;\n          this.notifications.addSuccess(this.text.updateSuccessful);\n        },\n        (_error) => this.inFlight = false,\n      );\n  }\n\n  private boardListActionColorClass(value?:HalResource):string {\n    const attribute = this.board.actionAttribute!;\n    if (value && value.id) {\n      return Highlighting.backgroundClass(attribute, value.id!);\n    } else {\n      return '';\n    }\n  }\n\n  public get listName() {\n    return this.query && this.query.name;\n  }\n\n  public showCardStatusButton() {\n    return this.board.showStatusButton();\n  }\n\n  public refreshQueryUnlessCaused(query:QueryResource, visibly = true) {\n    if (!this.causedUpdates.includes(query)) {\n      debugLog(`Refreshing ${query.name} visibly due to external changes`);\n      this.updateQuery(visibly);\n    }\n  }\n\n  public updateQuery(visibly = true) {\n    this.setQueryProps(this.boardFilters.current);\n    this.loadQuery(visibly);\n  }\n\n  private loadActionAttribute(query:QueryResource) {\n    if (!this.board.isAction) {\n      this.actionResource = undefined;\n      this.headerComponent = undefined;\n      this.canDragInto = !!query.updateOrderedWorkPackages;\n      return;\n    }\n\n    let actionService = this.actionService!;\n    const id = actionService.getActionValueId(query);\n\n    // Test if we loaded the resource already\n    if (this.actionResource && id === this.actionResource.href) {\n      return;\n    }\n\n    // Load the resource\n    actionService.getLoadedActionValue(query).then(async resource => {\n      this.actionResource = resource;\n      this.headerComponent = actionService.headerComponent();\n      this.buttonPlaceholder = actionService.disabledAddButtonPlaceholder(resource);\n      this.actionResourceClass = this.boardListActionColorClass(resource);\n      this.canDragInto = actionService.dragIntoAllowed(query, resource);\n\n      const canWriteAttribute = await actionService.canAddToQuery(query);\n      this.showAddButton = this.canDragInto && this.wpInlineCreate.canAdd && canWriteAttribute;\n      this.cdRef.detectChanges();\n    });\n  }\n\n  /**\n   * Return the linked action service\n   */\n  private get actionService():BoardActionService|undefined {\n    if (this.board.actionAttribute) {\n      return this.boardActionRegistry.get(this.board.actionAttribute);\n    }\n\n    return undefined;\n  }\n\n  /**\n   * Handler to properly update the work package, when\n   * adding to this query requires saving a changeset.\n   * @param workPackage\n   */\n  private addWorkPackage(workPackage:WorkPackageResource) {\n    let query = this.querySpace.query.value!;\n    const changeset = this.halEditing.changeFor(workPackage) as WorkPackageChangeset;\n\n    // Assign to the action attribute if this is an action board\n    this.actionService?.assignToWorkPackage(changeset, query);\n\n    if (changeset.isEmpty()) {\n      // Ensure work package and its schema is loaded\n      return this.apiv3Service.work_packages.cache.updateWorkPackage(workPackage);\n    } else {\n      // Save changes to the work package, which reloads it as well\n      return this.halEditing.save(changeset);\n    }\n  }\n\n  private get queryId():string {\n    return (this.resource.options.queryId as number|string).toString();\n  }\n\n  private loadQuery(visibly = true) {\n    let observable = this\n      .apiv3Service\n      .queries\n      .find(this.columnsQueryProps, this.queryId)\n      .pipe(\n        retry(3)\n      );\n\n    // Spread arguments on pipe does not work:\n    // https://github.com/ReactiveX/rxjs/issues/3989\n    if (visibly) {\n      observable = observable.pipe(withLoadingIndicator(this.indicatorInstance, 50));\n    }\n\n    observable\n      .subscribe(\n        query => this.wpStatesInitialization.updateQuerySpace(query, query.results),\n        error => {\n          this.loadingError = this.halNotification.retrieveErrorMessage(error);\n          this.cdRef.detectChanges();\n        }\n      );\n  }\n\n  private get indicatorInstance() {\n    return this.loadingIndicator.indicator(jQuery(this.indicator.nativeElement));\n  }\n\n  private setQueryProps(filters:ApiV3Filter[]) {\n    const existingFilters = (this.resource.options.filters || []) as ApiV3Filter[];\n\n    const newFilters = existingFilters.concat(filters);\n    const newColumnsQueryProps:any = {\n      'columns[]': ['id', 'subject'],\n      'showHierarchies': false,\n      'pageSize': 500,\n      'filters': JSON.stringify(newFilters),\n    };\n\n    this.columnsQueryProps = newColumnsQueryProps;\n  }\n\n  private listenToActionAttributeChanges() {\n\n    // If we don't have an action attribute\n    // nothing to do\n    if (!this.board.actionAttribute) {\n      return;\n    }\n\n    // Listen to hal events to detect changes to an action attribute\n    this.halEvents\n      .events$\n      .pipe(\n        filter(event => event.resourceType === 'WorkPackage'),\n        // Only allow updates, otherwise this causes an error reloading the list\n        // before the work package can be added to the query order\n        filter(event => event.eventType === 'updated'),\n        map((event:HalEvent) => event.commit?.changes[this.actionService!.filterName]),\n        filter(value => !!value),\n        filter((value:ChangeItem) => {\n\n          // Compare the from and to values from the committed changes\n          // with the current actionResource\n          const current = this.actionResource?.href;\n          const to = (value.to as HalResource|undefined)?.href;\n          const from = (value.from as HalResource|undefined)?.href;\n\n          return !!current && (current === to || current === from);\n        })\n      ).subscribe((event) => {\n      this.updateQuery(true);\n    });\n  }\n\n  openFullViewOnDoubleClick(event:{ workPackageId:string, double:boolean }) {\n    if (event.double) {\n      this.state.go(\n        'work-packages.show',\n        { workPackageId: event.workPackageId }\n      );\n    }\n  }\n\n  openStateLink(event:{ workPackageId:string; requestedState:string }) {\n    const params = { workPackageId: event.workPackageId };\n\n    this.$state.go(event.requestedState, params);\n  }\n\n  private schema(workPackage:WorkPackageResource) {\n    return this.schemaCache.of(workPackage);\n  }\n}\n","import {Component, Inject, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabComponent} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {CardHighlightingMode} from \"core-components/wp-fast-table/builders/highlighting/highlighting-mode.const\";\n\n@Component({\n  templateUrl: './highlighting-tab.component.html'\n})\nexport class BoardHighlightingTabComponent implements TabComponent {\n\n  // Highlighting mode\n  public highlightingMode:CardHighlightingMode = 'none';\n  public entireCardMode:boolean = false;\n  public lastEntireCardAttribute:CardHighlightingMode = 'type';\n\n  // Current board resource\n  public board:Board;\n\n  public text = {\n    highlighting_mode: {\n      description: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.description'),\n      none: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.none'),\n      type: this.I18n.t('js.work_packages.properties.type'),\n      priority: this.I18n.t('js.work_packages.table_configuration.highlighting_mode.priority'),\n      entire_card_by: this.I18n.t('js.card.highlighting.entire_card_by'),\n    }\n  };\n\n  constructor(readonly injector:Injector,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService) {\n  }\n\n  public onSave() {\n    this.updateMode(this.highlightingMode);\n    this.board.highlightingMode = this.highlightingMode;\n  }\n\n  ngOnInit() {\n    this.board = this.locals.board;\n    this.highlightingMode = this.board.highlightingMode;\n    this.updateMode(this.highlightingMode);\n  }\n\n  public updateMode(mode:CardHighlightingMode) {\n    if (mode === 'inline') {\n      this.highlightingMode = this.lastEntireCardAttribute;\n    } else {\n      this.highlightingMode = mode;\n    }\n\n    if (['priority', 'type'].indexOf(this.highlightingMode) !== -1) {\n      this.lastEntireCardAttribute = this.highlightingMode;\n      this.entireCardMode = true;\n    } else {\n      this.entireCardMode = false;\n    }\n\n  }\n}\n","<div>\n  <form>\n    <p [textContent]=\"text.highlighting_mode.description\"></p>\n    \n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"entireCardMode\"\n                 (change)=\"updateMode('inline')\"\n                 [value]=\"true\"\n                 name=\"entire_card_switch\">\n          <span [textContent]=\"text.highlighting_mode.entire_card_by\"></span>\n          &ngsp;\n          <select (change)=\"updateMode($event.target.value)\"\n                  id=\"selected_attribute\"\n                  name=\"selected_attribute\"\n                  class=\"form--select form--inline-select\">\n            <option [textContent]=\"text.highlighting_mode.type\"\n                    [selected]=\"lastEntireCardAttribute === 'type'\"\n                    value=\"type\"></option>\n            <option [textContent]=\"text.highlighting_mode.priority\"\n                    [selected]=\"lastEntireCardAttribute === 'priority'\"\n                    value=\"priority\"></option>\n          </select>\n        </label>\n      </div>\n    </div>\n    <div class=\"form--field -full-width\">\n      <div class=\"form--field-container\">\n        <label class=\"option-label\">\n          <input type=\"radio\"\n                 [(ngModel)]=\"highlightingMode\"\n                 (change)=\"updateMode($event.target.value)\"\n                 value=\"none\"\n                 name=\"highlighting_mode_switch\">\n          <span [textContent]=\"text.highlighting_mode.none\"></span>\n        </label>\n      </div>\n    </div>\n\n  </form>\n</div>\n\n","import {Injectable} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {TabInterface} from \"core-components/wp-table/configuration-modal/tab-portal-outlet\";\nimport {BoardHighlightingTabComponent} from \"core-app/modules/boards/board/configuration-modal/tabs/highlighting-tab.component\";\n\n@Injectable()\nexport class BoardConfigurationService {\n\n  protected _tabs:TabInterface[] = [\n    {\n      name: 'highlighting',\n      title: this.I18n.t('js.work_packages.table_configuration.highlighting'),\n      componentClass: BoardHighlightingTabComponent,\n    }\n  ];\n\n  constructor(readonly I18n:I18nService) {\n  }\n\n  public get tabs() {\n    return this._tabs;\n  }\n}\n","import {Board} from \"core-app/modules/boards/board/board\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {ComponentType} from \"@angular/cdk/portal\";\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {DisabledButtonPlaceholder} from \"core-app/modules/boards/board/board-list/board-list.component\";\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\nimport {FilterOperator} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {BoardListsService} from \"core-app/modules/boards/board/board-list/board-lists.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {Injectable, Injector} from \"@angular/core\";\nimport {map} from \"rxjs/operators\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {IFieldSchema} from \"core-app/modules/fields/field.base\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {WorkPackageFilterValues} from \"core-components/wp-edit-form/work-package-filter-values\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\nimport {SchemaCacheService} from \"core-components/schemas/schema-cache.service\";\nimport {Observable} from \"rxjs\";\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\n\n@Injectable()\nexport abstract class BoardActionService {\n\n  constructor(readonly injector:Injector,\n              protected boardListsService:BoardListsService,\n              protected I18n:I18nService,\n              protected halResourceService:HalResourceService,\n              protected pathHelper:PathHelperService,\n              protected currentProject:CurrentProjectService,\n              protected apiV3Service:APIV3Service,\n              protected schemaCache:SchemaCacheService) {\n  }\n\n  /**\n   * Get the attribute name\n   */\n  localizedName:string;\n\n  /**\n   * The action filter name\n   */\n  filterName:string;\n\n  /**\n   * The icon used in tile\n   */\n  icon:string;\n\n  /**\n   * The description used in tile\n   */\n  description:string;\n\n  /**\n   * The description used in tile\n   */\n  image:string;\n\n  /**\n   * Label used to describe the values in the modal\n   */\n  label:string;\n\n  /**\n   * The text used in tile header\n   */\n  text:string;\n\n  /**\n   * Returns the current filter instance\n   * @param query\n   */\n  getActionFilter(query:QueryResource, getHref = false):QueryFilterInstanceResource|undefined {\n    return query.filters.find(filter => filter.id === this.filterName);\n  }\n\n  /**\n   * Returns the current filter value ID if any\n   * @param query\n   * @returns The id of the resource\n   */\n  getActionValueId(query:QueryResource, getHref = false):string|undefined {\n    const filter = this.getActionFilter(query);\n    if (!filter) {\n      return;\n    }\n\n    const value = filter.values[0] as string|HalResource;\n\n    if (value instanceof HalResource) {\n      return getHref ? value.href! : value.id!;\n    }\n\n    return value;\n  }\n\n\n  /**\n   * Returns the current filter value if any\n   * @param query\n   * @returns The loaded action reosurce\n   */\n  getLoadedActionValue(query:QueryResource):Promise<HalResource|undefined> {\n    const id = this.getActionValueId(query);\n\n    if (!id) {\n      return Promise.resolve(undefined);\n    }\n\n    return this.require(id);\n  }\n\n  /**\n   * Add initial queries to a new board\n   *\n   * @param newBoard\n   */\n  addInitialColumnsForAction(newBoard:Board):Promise<Board> {\n    return Promise.resolve(newBoard);\n  }\n\n  /**\n   * Add a single action query\n   */\n  addColumnWithActionAttribute(board:Board, value:HalResource):Promise<Board> {\n    let params:any = {\n      name: value.name,\n    };\n\n    let filter = {\n      [this.filterName]: {\n        operator: '=' as FilterOperator,\n        values: [value.idFromLink]\n      }\n    };\n\n    return this.boardListsService.addQuery(board, params, [filter]);\n  }\n\n  /**\n   * Get available values from the active queries\n   *\n   * @param board The board we're looking at\n   * @param active The active set of values (resources or plain values)\n   * @param matching values matching the given name\n   */\n  loadAvailable(board:Board, active:Set<string>, matching:string):Observable<HalResource[]> {\n    return this\n      .loadValues(matching)\n      .pipe(\n        map(items => items.filter(item => !active.has(item.id!)))\n      );\n  }\n\n  /**\n   * Get action specific items that shall be shown in the list menu\n   * @returns {any[]}\n   */\n  getAdditionalListMenuItems(query:QueryResource):Promise<OpContextMenuItem[]> {\n    return Promise.resolve([]);\n  }\n\n  /**\n   * Get the specific component for the autocompleter (e.g versionAutocompleter)\n   * @returns {Component}\n   */\n  autocompleterComponent():ComponentType<unknown> {\n    return CreateAutocompleterComponent;\n  }\n\n  /**\n   * Get the specific header component for the board list, or undefined if none\n   * @returns {Component}\n   */\n  headerComponent():ComponentType<unknown>|undefined {\n    return undefined;\n  }\n\n  /**\n   * Get icon and text to show on the add button when it is disabled\n   * @returns {the icon class or nothing}\n   */\n  disabledAddButtonPlaceholder(resource?:HalResource):DisabledButtonPlaceholder|undefined {\n    return undefined;\n  }\n\n  /**\n   * Determines the specific warning to be shown, when there are no options to add as a list\n   * @returns {the text or nothing}\n   */\n  warningTextWhenNoOptionsAvailable(hasMember?:boolean):Promise<string|undefined> {\n    return Promise.resolve(undefined);\n  }\n\n  /**\n   * Determine whether we can drag items into a given query for the\n   * selected action value\n   *\n   * @param query\n   * @param value\n   */\n  dragIntoAllowed(query:QueryResource, value:HalResource|undefined):boolean {\n    return true;\n  }\n\n  /**\n   * Determine whether we can create new items for this action attribute\n   */\n  canAddToQuery(query:QueryResource):Promise<boolean> {\n    return Promise.resolve(true);\n  }\n\n  /**\n   * Determine whether the given work package can be moved\n   */\n  canMove(workPackage:WorkPackageResource):boolean {\n    const schema = this.schemaCache.of(workPackage);\n    const fieldSchema = schema[this.filterName] as IFieldSchema;\n    return fieldSchema?.writable;\n  }\n\n  /**\n   * Assign the work package to the action attribute\n   */\n  assignToWorkPackage(changeset:WorkPackageChangeset, query:QueryResource) {\n    // Ensure attribute remains writable in the form\n    if (!changeset.isWritable(this.filterName)) {\n      throw new Error(this.I18n.t(\n        'js.boards.error_attribute_not_writable',\n        { attribute: changeset.humanName(this.filterName) }\n      ));\n    }\n\n    new WorkPackageFilterValues(this.injector, query.filters)\n        .applyDefaultsFromFilters(changeset);\n  }\n\n  /**\n   * Require the given resource to be loaded.\n   *\n   * @param id\n   * @protected\n   */\n  protected abstract require(id:string):Promise<HalResource>;\n\n  /**\n   * Load values optionally matching the given name\n   *\n   * @param matching\n   * @protected\n   */\n  protected abstract loadValues(matching?:string):Observable<HalResource[]>;\n}\n\n","import {Injectable} from \"@angular/core\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {input} from \"reactivestates\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Observable} from \"rxjs\";\nimport {filter, map, take} from \"rxjs/operators\";\nimport {Board} from \"core-app/modules/boards/board/board\";\n\n@Injectable()\nexport abstract class CachedBoardActionService extends BoardActionService {\n  protected cache = input<HalResource[]>();\n\n  protected loadValues(matching?:string):Observable<HalResource[]> {\n    this\n      .cache\n      .putFromPromiseIfPristine(() => this.loadUncached());\n\n    return this\n      .cache\n      .values$()\n      .pipe(\n        map(results => {\n          if (matching) {\n            return results.filter(resource => resource.name.includes(matching));\n          } else {\n            return results;\n          }\n        }),\n        take(1)\n      );\n  }\n\n  addColumnWithActionAttribute(board:Board, value:HalResource):Promise<Board> {\n    if (this.cache.value) {\n      // Add the new value to the cache\n      let newValue = [...this.cache.value, value];\n      this.cache.putValue(newValue);\n    }\n\n    return super.addColumnWithActionAttribute(board, value);\n  }\n\n  protected require(id:string):Promise<HalResource> {\n    this\n      .cache\n      .putFromPromiseIfPristine(() => this.loadUncached());\n\n    return this\n      .cache\n      .values$()\n      .pipe(\n        take(1)\n      )\n      .toPromise()\n      .then(results => {\n        return results.find(resource => resource.id === id)!;\n      });\n  }\n\n  protected abstract loadUncached():Promise<HalResource[]>;\n}\n\n","<div class=\"status-board-header\" *ngIf=\"status\">\n  <h2 class=\"editable-toolbar-title--fixed\">\n    <small [textContent]=\"text.status\"></small>\n    <br/>\n    {{ status.name }}\n  </h2>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {Component, Input} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {StatusResource} from \"core-app/modules/hal/resources/status-resource\";\n\n\n@Component({\n  templateUrl: './status-board-header.html',\n  styleUrls: ['./status-board-header.sass'],\n  host: { 'class': 'title-container -small' }\n})\nexport class StatusBoardHeaderComponent {\n  @Input('resource') public status:StatusResource;\n\n  text = {\n    status: this.I18n.t('js.work_packages.properties.status')\n  };\n\n  constructor(readonly I18n:I18nService) {\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {StatusResource} from \"core-app/modules/hal/resources/status-resource\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {CachedBoardActionService} from \"core-app/modules/boards/board/board-actions/cached-board-action.service\";\nimport {StatusBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/status/status-board-header.component\";\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\n\n@Injectable()\nexport class BoardStatusActionService extends CachedBoardActionService {\n  filterName = 'status';\n\n  text =  this.I18n.t('js.boards.board_type.board_type_title.status');\n\n  description = this.I18n.t('js.boards.board_type.action_text_status');\n\n  label = this.I18n.t('js.boards.add_list_modal.labels.status');\n\n  icon = 'icon-workflow';\n\n  image = ImageHelpers.imagePath('board_creation_modal/status.svg');\n\n  public get localizedName() {\n    return this.I18n.t('js.work_packages.properties.status');\n  }\n\n  headerComponent() {\n    return StatusBoardHeaderComponent;\n  }\n\n  public addInitialColumnsForAction(board:Board):Promise<Board> {\n    return this\n      .loadValues()\n      .toPromise()\n      .then((results) =>\n        Promise.all<unknown>(\n          results.map((status:StatusResource) => {\n\n            if (status.isDefault) {\n              return this.addColumnWithActionAttribute(board, status);\n            }\n\n            return Promise.resolve(board);\n          })\n        )\n          .then(() => board)\n      );\n  }\n\n  public warningTextWhenNoOptionsAvailable() {\n    return Promise.resolve(this.I18n.t('js.boards.add_list_modal.warning.status'));\n  }\n\n  protected loadUncached():Promise<StatusResource[]> {\n    return this\n      .apiV3Service\n      .statuses\n      .get()\n      .toPromise()\n      .then(collection => collection.elements);\n  }\n}\n","<div class=\"version-board-header\"\n     [ngClass]=\"{ '-closed': version.isClosed(), '-locked': version.isLocked() }\"\n     *ngIf=\"version\">\n  <h2 class=\"editable-toolbar-title--fixed\">\n    <small [textContent]=\"text.version\"></small>\n    <br/>\n    <a [href]=\"pathHelper.versionShowPath(version.id)\"\n       [textContent]=\"version.name\"\n       target=\"_blank\">\n    </a>\n  </h2>\n\n  <span class=\"version-board-header--info-row -italic -small-font\"> {{version.endDate}}  </span>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {Component, Input} from \"@angular/core\";\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\n\n\n@Component({\n  templateUrl: './version-board-header.html',\n  styleUrls: ['./version-board-header.sass'],\n  host: { 'class': 'title-container -small' }\n})\nexport class VersionBoardHeaderComponent {\n  @Input('resource') public version:VersionResource;\n\n  constructor(readonly I18n:I18nService,\n              readonly pathHelper:PathHelperService) {\n  }\n\n  public text = {\n    isLocked: this.I18n.t('js.boards.version.is_locked'),\n    isClosed: this.I18n.t('js.boards.version.is_closed'),\n    version: this.I18n.t('js.work_packages.properties.version')\n  };\n}\n","import {Injectable} from \"@angular/core\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {VersionResource} from \"core-app/modules/hal/resources/version-resource\";\nimport {VersionAutocompleterComponent} from \"core-app/modules/common/autocomplete/version-autocompleter.component\";\nimport {OpContextMenuItem} from \"core-components/op-context-menu/op-context-menu.types\";\nimport {LinkHandling} from \"core-app/modules/common/link-handling/link-handling\";\nimport {StateService} from \"@uirouter/core\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {VersionBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/version/version-board-header.component\";\nimport {FormResource} from \"core-app/modules/hal/resources/form-resource\";\nimport {InjectField} from \"core-app/helpers/angular/inject-field.decorator\";\nimport {CachedBoardActionService} from \"core-app/modules/boards/board/board-actions/cached-board-action.service\";\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\n\n@Injectable()\nexport class BoardVersionActionService extends CachedBoardActionService {\n  @InjectField() state:StateService;\n  @InjectField() halNotification:HalResourceNotificationService;\n\n  filterName = 'version';\n\n  text = this.I18n.t('js.boards.board_type.board_type_title.version');\n\n  description = this.I18n.t('js.boards.board_type.action_text_version');\n\n  label = this.I18n.t('js.boards.add_list_modal.labels.version');\n\n  icon = 'icon-getting-started';\n\n  image = ImageHelpers.imagePath('board_creation_modal/version.svg');\n\n  private writable$:Promise<boolean>;\n\n  public get localizedName() {\n    return this.I18n.t('js.work_packages.properties.version');\n  }\n\n  public canAddToQuery(query:QueryResource):Promise<boolean> {\n    const formLink = _.get(query, 'results.createWorkPackage.href', null);\n\n    if (!formLink) {\n      return Promise.resolve(false);\n    }\n\n    if (!this.writable$) {\n      this.writable$ = query.results.createWorkPackage()\n        .then((form:FormResource) => form.schema.version.writable);\n    }\n\n    return this.writable$;\n  }\n\n  public addInitialColumnsForAction(board:Board):Promise<Board> {\n    return this\n      .loadValues()\n      .toPromise()\n      .then((results) => {\n        return Promise.all<unknown>(\n          results.map((version:VersionResource) => {\n            const definingName = _.get(version, 'definingProject.name', null);\n            if (version.isOpen() && definingName && definingName === this.currentProject.name) {\n              return this.addColumnWithActionAttribute(board, version);\n            }\n\n            return Promise.resolve(board);\n          })\n        )\n          .then(() => board);\n      });\n  }\n\n  /**\n   * Adds an entry to the list menu to edit the version if allowed\n   * @param {QueryResource} query The active query\n   * @returns {Promise<any>}\n   */\n  public getAdditionalListMenuItems(query:QueryResource):Promise<OpContextMenuItem[]> {\n    return this\n      .getLoadedActionValue(query)\n      .then((version:VersionResource) => {\n        if (version) {\n          return this.buildItemsForVersion(version);\n        } else {\n          return [];\n        }\n      });\n  }\n\n  public autocompleterComponent() {\n    return VersionAutocompleterComponent;\n  }\n\n  public headerComponent() {\n    return VersionBoardHeaderComponent;\n  }\n\n  public disabledAddButtonPlaceholder(version:VersionResource) {\n    if (version.isLocked()) {\n      return { icon: 'locked', text: this.I18n.t('js.boards.version.locked') };\n    } else if (version.isClosed()) {\n      return { icon: 'not-supported', text: this.I18n.t('js.boards.version.closed') };\n    } else {\n      return undefined;\n    }\n  }\n\n  public dragIntoAllowed(query:QueryResource, value:HalResource|undefined) {\n    return value instanceof VersionResource && value.isOpen();\n  }\n\n  protected loadUncached():Promise<HalResource[]> {\n    if (this.currentProject.id === null) {\n      return Promise.resolve([]);\n    }\n\n    return this\n      .apiV3Service\n      .projects\n      .id(this.currentProject.id!)\n      .versions\n      .get()\n      .toPromise()\n      .then(collection => collection.elements);\n  }\n\n  private patchVersionStatus(version:VersionResource, newStatus:'open'|'closed'|'locked') {\n    this.apiV3Service\n      .versions\n      .id(version)\n      .patch({ status: newStatus })\n      .subscribe(\n        version => {\n        this.state.go('.', {}, { reload: true });\n        },\n        error => this.halNotification.handleRawError(error)\n      );\n  }\n\n  private buildItemsForVersion(version:VersionResource):OpContextMenuItem[] {\n    const id = version.id!;\n    return [\n      {\n        // Lock version\n        hidden: !version.isOpen() || (version.isLocked() && !version.$links.update),\n        linkText: this.I18n.t('js.boards.version.lock_version'),\n        onClick: () => {\n          this.patchVersionStatus(version, 'locked');\n          return true;\n        }\n      },\n      {\n        // Unlock version\n        hidden: !version.isLocked() || (version.isOpen() && !version.$links.update),\n        linkText: this.I18n.t('js.boards.version.unlock_version'),\n        onClick: () => {\n          this.patchVersionStatus(version, 'open');\n          return true;\n        }\n      },\n      {\n        // Close version\n        hidden: version.isClosed() || (!version.isClosed() && !version.$links.update),\n        linkText: this.I18n.t('js.boards.version.close_version'),\n        onClick: () => {\n          this.patchVersionStatus(version, 'closed');\n          return true;\n        }\n      },\n      {\n        // Open version\n        hidden: !version.isClosed() || (version.isClosed() && !version.$links.update),\n        linkText: this.I18n.t('js.boards.version.open_version'),\n        onClick: () => {\n          this.patchVersionStatus(version, 'open');\n          return true;\n        }\n      },\n      {\n        // Show link\n        linkText: this.I18n.t('js.boards.version.show_version'),\n        href: this.pathHelper.versionShowPath(id),\n        onClick: (evt:JQuery.TriggeredEvent) => {\n          if (!LinkHandling.isClickedWithModifier(evt)) {\n            window.open(this.pathHelper.versionShowPath(id), '_blank');\n            return true;\n          }\n\n          return false;\n        }\n      },\n      {\n        // Edit link\n        hidden: !version.$links.update,\n        linkText: this.I18n.t('js.boards.version.edit_version'),\n        href: this.pathHelper.versionEditPath(id),\n        onClick: (evt:JQuery.TriggeredEvent) => {\n          if (!LinkHandling.isClickedWithModifier(evt)) {\n            window.open(this.pathHelper.versionEditPath(id), '_blank');\n            return true;\n          }\n\n          return false;\n        }\n      }\n    ];\n  }\n}\n","import {Inject, Injectable} from \"@angular/core\";\nimport {DOCUMENT} from \"@angular/common\";\nimport {BehaviorSubject, Observable, Subject} from \"rxjs\";\nimport {debugLog} from \"core-app/helpers/debug_output\";\n\n@Injectable({ providedIn: 'root' })\nexport class ActiveWindowService {\n\n  private activeState$ = new BehaviorSubject<boolean>(true);\n\n  constructor(@Inject(DOCUMENT) document:Document) {\n    document.addEventListener('visibilitychange', () => {\n      if (!!document.visibilityState) {\n        debugLog(\"Browser window has visibility state changed to \" + document.visibilityState);\n        this.activeState$.next(document.visibilityState === 'visible');\n      }\n    });\n  }\n\n  /**\n   * Returns whether the browser window/tab is active\n   */\n  public get isActive():boolean {\n    return this.activeState$.value;\n  }\n\n  /**\n   * Observable for notifying when visibility changes\n   */\n  public get active$():Observable<boolean> {\n    return this.activeState$.asObservable();\n  }\n}","import {Injectable} from \"@angular/core\";\nimport {interval} from 'rxjs';\nimport {startWith, switchMap, filter} from 'rxjs/operators';\nimport {ActiveWindowService} from \"core-app/modules/common/active-window/active-window.service\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\nconst POLLING_INTERVAL = 2000;\n\n@Injectable()\nexport class QueryUpdatedService {\n\n  constructor(readonly activeWindow:ActiveWindowService,\n              readonly apiV3Service:APIV3Service) {\n  }\n\n  public monitor(ids:string[]) {\n    let time = new Date();\n\n    return interval(POLLING_INTERVAL)\n      .pipe(\n        startWith(0),\n        filter(() => ids.length > 0),\n             filter(() => this.activeWindow.isActive),\n        switchMap(() => {\n          let result = this.queryForUpdates(ids, time);\n\n          time = new Date();\n\n          return result;\n        }),\n        filter((collection) => collection.count > 0)\n      );\n  }\n\n  private queryForUpdates(ids:string[], updatedAfter:Date) {\n    return this\n      .apiV3Service\n      .queries\n      .list({\n        filters: [[\"id\", \"=\", ids],\n          [\"updatedAt\", \"<>d\", [updatedAfter.toISOString()]]]\n      });\n  }\n}\n","<div class=\"assignee-board-header\" *ngIf=\"user\">\n  <user-avatar *ngIf=\"user.id\" [user]=\"user\" data-class-list=\"avatar-mini\"></user-avatar>\n  <h2 class=\"editable-toolbar-title--fixed\">\n    <small [textContent]=\"text.assignee\"></small>\n    <br/>\n    <a [href]=\"pathHelper.userPath(user.id)\"\n       [textContent]=\"user.name\"\n       target=\"_blank\">\n    </a>\n  </h2>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {Component, Input} from \"@angular/core\";\nimport {UserResource} from \"core-app/modules/hal/resources/user-resource\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n\n@Component({\n  templateUrl: './assignee-board-header.html',\n  styleUrls: ['./assignee-board-header.sass'],\n  host: { 'class': 'title-container -small' }\n})\nexport class AssigneeBoardHeaderComponent {\n  @Input('resource') public user:UserResource;\n\n  text = {\n    assignee: this.I18n.t('js.work_packages.properties.assignee')\n  };\n\n  constructor(readonly pathHelper:PathHelperService,\n              readonly I18n:I18nService) {\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {AssigneeBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/assignee/assignee-board-header.component\";\nimport {ProjectResource} from \"core-app/modules/hal/resources/project-resource\";\nimport {CachedBoardActionService} from \"core-app/modules/boards/board/board-actions/cached-board-action.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {ApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\nimport imagePath = ImageHelpers.imagePath;\n\n@Injectable()\nexport class BoardAssigneeActionService extends CachedBoardActionService {\n  filterName = 'assignee';\n\n  text = this.I18n.t('js.boards.board_type.board_type_title.assignee');\n\n  description = this.I18n.t('js.boards.board_type.action_text_assignee');\n\n  label = this.I18n.t('js.boards.add_list_modal.labels.assignee');\n\n  icon = 'icon-user';\n\n  image = ImageHelpers.imagePath('board_creation_modal/assignees.svg');\n\n  readonly unassignedUser:any = {\n    id: null,\n    href: null,\n    name: this.I18n.t('js.filter.noneElement')\n  };\n\n  /**\n   * Add a single action query\n   */\n  addColumnWithActionAttribute(board:Board, value:HalResource):Promise<Board> {\n    let params:any = {\n      name: value.name,\n    };\n\n    let filter:ApiV3Filter;\n\n    if (value.id === null) {\n      filter = {\n        assignee: {\n          operator: '!*',\n          values: []\n        }\n      };\n    } else {\n      filter = {\n        assignee: {\n          operator: '=',\n          values: [value.idFromLink]\n        }\n      };\n    }\n\n    return this.boardListsService.addQuery(board, params, [filter]);\n  }\n\n  /**\n   * Returns the current filter value if any\n   * @param query\n   * @returns The loaded action reosurce\n   */\n  getLoadedActionValue(query:QueryResource):Promise<HalResource|undefined> {\n    const filter = this.getActionFilter(query);\n\n    // Return the special unassigned user\n    if (filter && filter.operator.id === '!*') {\n      return Promise.resolve(this.unassignedUser);\n    }\n\n    return super.getLoadedActionValue(query);\n  }\n\n  public get localizedName() {\n    return this.I18n.t('js.work_packages.properties.assignee');\n  }\n\n  public headerComponent() {\n    return AssigneeBoardHeaderComponent;\n  }\n\n  public warningTextWhenNoOptionsAvailable(hasMember?:boolean) {\n    let text = hasMember ?\n    this.I18n.t('js.boards.add_list_modal.warning.assignee'):\n    this.I18n.t('js.boards.add_list_modal.warning.no_member');\n\n    return this\n      .apiV3Service\n      .projects\n      .id(this.currentProject.id!)\n      .get()\n      .toPromise()\n      .then((project:ProjectResource) => {\n        if (project.memberships) {\n          text = text.concat(\n            this.I18n.t('js.boards.add_list_modal.warning.add_members', {\n              link: this.pathHelper.projectMembershipsPath(this.currentProject.identifier!)\n            })\n          );\n        }\n\n        return text;\n      });\n  }\n\n  protected loadUncached():Promise<HalResource[]> {\n    return this\n      .apiV3Service\n      .projects\n      .id(this.currentProject.identifier!)\n      .available_assignees\n      .get()\n      .toPromise()\n      .then(\n        (collection:CollectionResource<UserResource>) => [this.unassignedUser].concat(collection.elements)\n      );\n  }\n}\n","<div class=\"subproject-board-header\" *ngIf=\"resource\">\n  <h2 class=\"editable-toolbar-title--fixed\">\n    <small [textContent]=\"text.project\"></small>\n    <br/>\n    <a [href]=\"pathHelper.projectPath(resource.idFromLink)\"\n       [textContent]=\"resource.name\"\n       target=\"_blank\">\n    </a>\n  </h2>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {Component, Input} from \"@angular/core\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\n\n\n@Component({\n  templateUrl: './subproject-board-header.html',\n  styleUrls: ['./subproject-board-header.sass'],\n  host: { 'class': 'title-container -small' }\n})\nexport class SubprojectBoardHeaderComponent {\n  @Input() public resource:HalResource;\n\n  text = {\n    project: this.I18n.t('js.time_entry.project')\n  };\n\n  constructor(readonly pathHelper:PathHelperService,\n              readonly I18n:I18nService) {\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {buildApiV3Filter} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {UserResource} from 'core-app/modules/hal/resources/user-resource';\nimport {CollectionResource} from 'core-app/modules/hal/resources/collection-resource';\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {SubprojectBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/subproject/subproject-board-header.component\";\nimport {CachedBoardActionService} from \"core-app/modules/boards/board/board-actions/cached-board-action.service\";\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\n\n@Injectable()\nexport class BoardSubprojectActionService extends CachedBoardActionService {\n  filterName = 'onlySubproject';\n\n  text =  this.I18n.t('js.boards.board_type.board_type_title.subproject');\n\n  description = this.I18n.t('js.boards.board_type.action_text_subprojects');\n\n  label = this.I18n.t('js.boards.add_list_modal.labels.subproject');\n\n  icon = 'icon-projects';\n\n  image = ImageHelpers.imagePath('board_creation_modal/subproject.svg');\n\n  get localizedName() {\n    return this.I18n.t('js.work_packages.properties.subproject');\n  }\n\n  headerComponent() {\n    return SubprojectBoardHeaderComponent;\n  }\n\n  canMove(workPackage:WorkPackageResource):boolean {\n    // We can only move the work package\n    // if the `move` (move between projects) is allowed.\n    return !!workPackage.move;\n  }\n\n  assignToWorkPackage(changeset:WorkPackageChangeset, query:QueryResource) {\n    const href = this.getActionValueId(query, true);\n    changeset.setValue('project', { href: href });\n  }\n\n  protected loadUncached():Promise<HalResource[]> {\n    const currentProjectId = this.currentProject.id!;\n    return this\n        .apiV3Service\n        .projects\n        .filtered(buildApiV3Filter('ancestor', '=', [currentProjectId]))\n        .get()\n        .toPromise()\n        .then((collection:CollectionResource<UserResource>) => collection.elements);\n  }\n\n}\n","<div class=\"subtask-board-header\" *ngIf=\"resource\">\n  <h2 class=\"editable-toolbar-title--fixed\">\n    <small [textContent]=\"text.workPackage\"></small>\n    <br/>\n    <span class=\"work-package-type\"\n          [ngClass]=\"typeHighlightingClass\"\n          [textContent]=\"resource.type.name\">\n    </span>\n    <a [href]=\"pathHelper.workPackagePath(resource.idFromLink)\"\n       [textContent]=\"resource.subjectWithId()\"\n       target=\"_blank\">\n    </a>\n  </h2>\n</div>\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\nimport {Component, Input, OnInit} from \"@angular/core\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {PathHelperService} from \"core-app/modules/common/path-helper/path-helper.service\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {Highlighting} from \"core-components/wp-fast-table/builders/highlighting/highlighting.functions\";\n\n\n@Component({\n  templateUrl: './subtasks-board-header.html',\n  styleUrls: ['./subtasks-board-header.sass'],\n  host: { 'class': 'title-container -small' }\n})\nexport class SubtasksBoardHeaderComponent implements OnInit {\n  @Input() public resource:WorkPackageResource;\n\n  text = {\n    workPackage: this.I18n.t('js.label_work_package_parent')\n  };\n\n  typeHighlightingClass:string;\n\n  constructor(readonly pathHelper:PathHelperService,\n              readonly I18n:I18nService) {\n  }\n\n  ngOnInit() {\n    this.typeHighlightingClass = Highlighting.inlineClass('type', this.resource.type.id!);\n  }\n}\n","import {Injectable} from \"@angular/core\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {WorkPackageResource} from \"core-app/modules/hal/resources/work-package-resource\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {Observable} from \"rxjs\";\nimport {map} from \"rxjs/operators\";\nimport {ApiV3FilterBuilder} from \"core-components/api/api-v3/api-v3-filter-builder\";\nimport {SubtasksBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/subtasks/subtasks-board-header.component\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {WorkPackageChangeset} from \"core-components/wp-edit/work-package-changeset\";\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\n\n@Injectable()\nexport class BoardSubtasksActionService extends BoardActionService {\n  filterName = 'parent';\n\n  text = this.I18n.t('js.boards.board_type.board_type_title.subtasks');\n\n  description = this.I18n.t('js.boards.board_type.action_text_subtasks');\n\n  label = this.I18n.t('js.boards.add_list_modal.labels.subtasks');\n\n  icon = 'icon-hierarchy';\n\n  image = ImageHelpers.imagePath('board_creation_modal/parent-child.svg');\n\n  public get localizedName() {\n    return this.I18n.t('js.boards.board_type.action_type.subtasks');\n  }\n\n  public headerComponent() {\n    return SubtasksBoardHeaderComponent;\n  }\n\n  public canMove(workPackage:WorkPackageResource):boolean {\n    return !!workPackage.changeParent;\n  }\n\n  assignToWorkPackage(changeset:WorkPackageChangeset, query:QueryResource) {\n    const parentId = this.getActionValueId(query)?.toString();\n\n    // Disable dragging a work package into its own column\n    if (parentId === changeset.id) {\n      throw new Error(this.I18n.t('js.boards.error_cannot_move_into_self'));\n    }\n\n    super.assignToWorkPackage(changeset, query);\n  }\n\n  protected loadValues(matching?:string):Observable<HalResource[]> {\n    let filters = new ApiV3FilterBuilder();\n    filters.add('is_milestone', '=', false);\n    filters.add('project', '=', [this.currentProject.id]);\n\n    if (matching) {\n      filters.add('subjectOrId', '**', [matching]);\n    }\n\n    return this\n      .apiV3Service\n      .work_packages\n      .filtered(filters)\n      .get()\n      .pipe(\n        map(collection => collection.elements)\n      );\n  }\n\n  protected require(id:string):Promise<HalResource> {\n    return this\n      .apiV3Service\n      .work_packages\n      .id(id)\n      .get()\n      .toPromise();\n  }\n}\n","import {Component, Injector} from \"@angular/core\";\nimport {BoardConfigurationService} from \"core-app/modules/boards/board/configuration-modal/board-configuration.service\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {BoardStatusActionService} from \"core-app/modules/boards/board/board-actions/status/status-action.service\";\nimport {BoardVersionActionService} from \"core-app/modules/boards/board/board-actions/version/version-action.service\";\nimport {QueryUpdatedService} from \"core-app/modules/boards/board/query-updated/query-updated.service\";\nimport {BoardAssigneeActionService} from \"core-app/modules/boards/board/board-actions/assignee/assignee-action.service\";\nimport {BoardSubprojectActionService} from \"core-app/modules/boards/board/board-actions/subproject/subproject-action.service\";\nimport {BoardSubtasksActionService} from \"core-app/modules/boards/board/board-actions/subtasks/board-subtasks-action.service\";\n\n@Component({\n  selector: 'boards-entry',\n  template: '<ui-view wp-isolated-query-space></ui-view>',\n  providers: [\n    BoardConfigurationService,\n    BoardStatusActionService,\n    BoardVersionActionService,\n    BoardAssigneeActionService,\n    BoardSubprojectActionService,\n    BoardSubtasksActionService,\n    QueryUpdatedService,\n  ]\n})\nexport class BoardsRootComponent {\n\n  constructor(readonly injector:Injector) {\n\n    // Register action services\n    const registry = injector.get(BoardActionsRegistryService);\n\n    registry.add('status', injector.get(BoardStatusActionService));\n    registry.add('assignee', injector.get(BoardAssigneeActionService));\n    registry.add('version', injector.get(BoardVersionActionService));\n    registry.add('subproject', injector.get(BoardSubprojectActionService));\n    registry.add('subtasks', injector.get(BoardSubtasksActionService));\n  }\n}\n","<div class=\"op-modal--portal\">\n  <div class=\"op-modal--modal-container -wide wp-table--configuration-modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <h3 [textContent]=\"text.title\"></h3>\n\n      <a class=\"op-modal--modal-close-button\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.closePopup\">\n        </i>\n      </a>\n    </div>\n\n    <div *ngIf=\"!!tabPortalHost\"\n         class=\"content--tabs scrollable-tabs\">\n      <ul class=\"tabrow\">\n        <li *ngFor=\"let tab of availableTabs\"\n            [ngClass]=\"{ 'selected': currentTab && tab.name === currentTab.name }\">\n          <a class=\"tab-show\"\n             role=\"button\"\n             [ngClass]=\"{ '-disabled': tab.disableBecause != null, 'selected': currentTab && tab.name === currentTab.name }\"\n             [attr.title]=\"tab.disableBecause || tab.title\"\n             [textContent]=\"tab.title\"\n             (click)=\"switchTo(tab.name)\"\n             href>\n          </a>\n      </ul>\n    </div>\n\n    <div class=\"tab-content\" #tabContentOutlet></div>\n    <div class=\"modal--form-actions\">\n      <button class=\"button -highlight\"\n              [textContent]=\"text.applyButton\"\n              (click)=\"saveChanges()\">\n      </button>\n      <button class=\"button\"\n              [textContent]=\"text.cancelButton\"\n              (click)=\"closeMe($event)\">\n      </button>\n    </div>\n  </div>\n</div>\n","import {\n  ApplicationRef,\n  ChangeDetectorRef,\n  Component,\n  ComponentFactoryResolver,\n  ElementRef,\n  Inject,\n  Injector,\n  OnDestroy,\n  OnInit,\n  ViewChild\n} from '@angular/core';\nimport {OpModalLocalsMap} from 'core-components/op-modals/op-modal.types';\nimport {OpModalComponent} from 'core-components/op-modals/op-modal.component';\nimport {\n  ActiveTabInterface,\n  TabComponent,\n  TabInterface,\n  TabPortalOutlet\n} from 'core-components/wp-table/configuration-modal/tab-portal-outlet';\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {BoardConfigurationService} from \"core-app/modules/boards/board/configuration-modal/board-configuration.service\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\n\n\n@Component({\n  templateUrl: './board-configuration.modal.html'\n})\nexport class BoardConfigurationModal extends OpModalComponent implements OnInit, OnDestroy  {\n\n  /* Close on escape? */\n  public closeOnEscape = false;\n\n  /* Close on outside click */\n  public closeOnOutsideClick = false;\n\n  public text = {\n    title: this.I18n.t('js.boards.configuration_modal.title'),\n    closePopup: this.I18n.t('js.close_popup_title'),\n\n    applyButton: this.I18n.t('js.modals.button_apply'),\n    cancelButton: this.I18n.t('js.modals.button_cancel'),\n  };\n\n  // Get the view child we'll use as the portal host\n  @ViewChild('tabContentOutlet', { static: true }) tabContentOutlet:ElementRef;\n  // And a reference to the actual portal host interface\n  public tabPortalHost:TabPortalOutlet;\n\n  constructor(@Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly I18n:I18nService,\n              readonly boardService:BoardService,\n              readonly boardConfigurationService:BoardConfigurationService,\n              readonly injector:Injector,\n              readonly appRef:ApplicationRef,\n              readonly componentFactoryResolver:ComponentFactoryResolver,\n              readonly cdRef:ChangeDetectorRef,\n              readonly elementRef:ElementRef) {\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    this.$element = jQuery(this.elementRef.nativeElement);\n\n    this.tabPortalHost = new TabPortalOutlet(\n      this.boardConfigurationService.tabs,\n      this.tabContentOutlet.nativeElement,\n      this.componentFactoryResolver,\n      this.appRef,\n      this.injector\n    );\n\n    setTimeout(() => {\n      const initialTab = this.availableTabs[0].name;\n      this.switchTo(initialTab);\n    });\n  }\n\n  ngOnDestroy() {\n    this.tabPortalHost.dispose();\n  }\n\n  public get availableTabs():TabInterface[] {\n    return this.tabPortalHost.availableTabs;\n  }\n\n  public get currentTab():ActiveTabInterface|null {\n    return this.tabPortalHost.currentTab;\n  }\n\n  public switchTo(name:string) {\n    this.tabPortalHost.switchTo(name);\n  }\n\n  public saveChanges():void {\n    this.tabPortalHost.activeComponents.forEach((component:TabComponent) => {\n      component.onSave();\n    });\n\n    const board = this.locals.board as Board;\n    this.boardService\n      .save(board)\n      .subscribe(board => {\n        this.service.close();\n      });\n\n  }\n\n  /**\n   * Called when the user attempts to close the modal window.\n   * The service will close this modal if this method returns true\n   * @returns {boolean}\n   */\n  public onClose():boolean {\n    this.afterFocusOn.focus();\n    return true;\n  }\n\n  protected get afterFocusOn():JQuery {\n    return this.$element;\n  }\n}\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {Directive, ElementRef, Injector, Input} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {BoardConfigurationModal} from \"core-app/modules/boards/board/configuration-modal/board-configuration.modal\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {StateService} from \"@uirouter/core\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {triggerEditingEvent} from \"core-app/modules/common/editable-toolbar-title/editable-toolbar-title.component\";\n\n@Directive({\n  selector: '[boardsToolbarMenu]'\n})\nexport class BoardsToolbarMenuDirective extends OpContextMenuTrigger {\n  @Input('boardsToolbarMenu-resource') public board:Board;\n\n  public text = {\n    deleteSuccessful: this.I18n.t('js.notice_successful_delete'),\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly opModalService:OpModalService,\n              readonly boardService:BoardService,\n              readonly Notifications:NotificationsService,\n              readonly State:StateService,\n              readonly injector:Injector,\n              readonly I18n:I18nService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  public get locals() {\n    return {\n      contextMenuId: 'boardsToolbarMenu',\n      items: this.items\n    };\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  private buildItems() {\n    this.items = [\n      {\n        // Configuration modal\n        linkText: this.I18n.t('js.toolbar.settings.configure_view'),\n        icon: 'icon-settings',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          this.opContextMenu.close();\n          this.opModalService.show(BoardConfigurationModal, this.injector, { board: this.board });\n\n          return true;\n        }\n      },\n      {\n        // Rename query shortcut\n        linkText: this.I18n.t('js.toolbar.settings.page_settings'),\n        icon: 'icon-edit',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (!!this.board.grid.updateImmediately) {\n            jQuery(`.toolbar-container .editable-toolbar-title--input`).trigger(triggerEditingEvent);\n          }\n\n          return true;\n        }\n      },\n      {\n        // Delete query\n        linkText: this.I18n.t('js.toolbar.settings.delete'),\n        icon: 'icon-delete',\n        onClick: ($event:JQuery.TriggeredEvent) => {\n          if (this.board.grid.delete &&\n            window.confirm(this.I18n.t('js.text_query_destroy_confirmation'))) {\n            this.boardService\n              .delete(this.board)\n              .then(() => {\n                this.State.go('boards.list', { flash_message: { type: 'success', message: this.text.deleteSuccessful } });\n              });\n          }\n\n          return true;\n        }\n      }\n    ];\n  }\n}\n","<div class=\"tile-blocks--container\">\n    <div class=\"tile-block button\" \n        [disabled]=\"disabled()\" \n        (accessibleClick)=\"created(tile.attribute)\"\n        *ngFor=\"let tile of tiles\">\n        <img [src]=\"tile.image\" class=\"tile-block-image\"/>\n        <div>\n          <span class=\"tile-block-title\">{{ tile.text }}</span> \n          <p class=\"tile-block-description\" [textContent]=\"tile.description\"></p>\n        </div>\n    </div>\n</div>","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, EventEmitter, Input, OnInit, Output} from \"@angular/core\";\n\nexport interface ITileViewEntry {\n    text:string;\n    attribute:string;\n    icon:string;\n    description:string;\n    image:string;\n  }\n\n  @Component({\n    selector: 'tile-view',\n    styleUrls: ['./tile-view.component.sass'],\n    templateUrl: './tile-view.component.html',\n    changeDetection: ChangeDetectionStrategy.OnPush\n  })\n  export class TileViewComponent {\n    @Input() public tiles:ITileViewEntry[];\n    @Input() public disable:boolean = false;\n\n    @Output() public create = new EventEmitter<string>();\n\n    public disabled() {\n      return this.disable;\n    }\n\n    public created(attribute:string) {\n      this.create.emit(attribute);\n    }\n\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject, ViewChild} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {BoardType} from \"core-app/modules/boards/board/board\";\nimport {StateService} from \"@uirouter/core\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {ITileViewEntry} from '../tile-view/tile-view.component';\nimport {ImageHelpers} from \"core-app/helpers/images/path-helper\";\nimport imagePath = ImageHelpers.imagePath;\n\n\n@Component({\n  templateUrl: './new-board-modal.html',\n})\nexport class NewBoardModalComponent extends OpModalComponent {\n  @ViewChild('actionAttributeSelect', { static: true }) actionAttributeSelect:ElementRef;\n\n  public showClose:boolean = true;\n\n  public confirmed = false;\n\n  public available = this.boardActions.available();\n\n  public inFlight = false;\n\n  public text:any = {\n    close_popup: this.I18n.t('js.close_popup_title'),\n\n    free_board: this.I18n.t('js.boards.board_type.free'),\n    free_board_text: this.I18n.t('js.boards.board_type.free_text'),\n    free_board_title: this.I18n.t('js.boards.board_type.board_type_title.basic'),\n    board_type: this.I18n.t('js.boards.board_type.text'),\n\n    action_board: this.I18n.t('js.boards.board_type.action'),\n    action_board_text: this.I18n.t('js.boards.board_type.action_text'),\n    select_attribute: this.I18n.t('js.boards.board_type.select_attribute'),\n    select_board_type: this.I18n.t('js.boards.board_type.select_board_type'),\n    placeholder: this.I18n.t('js.placeholders.selection'),\n  };\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly state:StateService,\n              readonly boardService:BoardService,\n              readonly boardActions:BoardActionsRegistryService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly loadingIndicatorService:LoadingIndicatorService,\n              readonly I18n:I18nService,\n              readonly boardActionRegistry:BoardActionsRegistryService) {\n\n    super(locals, cdRef, elementRef);\n    this.initiateTiles();\n  }\n\n  public createBoard(attribute:string) {\n    if (attribute === 'basic') {\n      this.createFree();\n    } else {\n      this.createAction(attribute);\n    }\n  }\n\n  private initiateTiles() {\n    this.available.unshift({\n      attribute: 'basic',\n      text: this.text.free_board_title,\n      icon: 'icon-boards',\n      description: this.text.free_board_text,\n      image: imagePath('board_creation_modal/lists.svg')\n    });\n    this.addIcon(this.available);\n    this.addDescription(this.available);\n    this.addText(this.available);\n    this.addImage(this.available);\n  }\n\n  private createFree() {\n    this.create({ type: 'free' });\n  }\n\n  private createAction(attribute:string) {\n    this.create({ type: 'action', attribute: attribute! });\n  }\n\n  private create(params:{ type:BoardType, attribute?:string }) {\n    this.inFlight = true;\n\n    this.loadingIndicatorService.modal.promise = this.boardService\n      .create(params)\n      .then((board) => {\n        this.inFlight = false;\n        this.closeMe();\n        this.state.go('boards.partitioned.show', { board_id: board.id, isNew: true });\n      })\n      .catch((error:unknown) => {\n        this.inFlight = false;\n        this.halNotification.handleRawError(error);\n      });\n  }\n\n  private addDescription(tiles:ITileViewEntry[]) {\n    tiles.forEach(element => {\n      if (element.attribute !== 'basic') {\n        const service = this.boardActionRegistry.get(element.attribute!);\n        element.description = service.description;\n      }\n    });\n  }\n\n  private addIcon(tiles:ITileViewEntry[]) {\n    tiles.forEach(element => {\n      if (element.attribute !== 'basic') {\n        const service = this.boardActionRegistry.get(element.attribute!);\n        element.icon = service.icon;\n      }\n    });\n  }\n\n  private addText(tiles:ITileViewEntry[]) {\n    tiles.forEach(element => {\n      if (element.attribute !== 'basic') {\n        const service = this.boardActionRegistry.get(element.attribute!);\n        element.text = service.text;\n      }\n    });\n  }\n\n  private addImage(tiles:ITileViewEntry[]) {\n    tiles.forEach(element => {\n      if (element.attribute !== 'basic') {\n        const service = this.boardActionRegistry.get(element.attribute!);\n        element.image = service.image;\n      }\n    });\n  }\n}\n","<div class=\"op-modal--portal confirm-form-submit--modal  ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container confirm-dialog--modal loading-indicator--location\"\n       data-indicator-name=\"modal\"\n    tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i \n        class=\"icon-close\"\n        (click)=\"closeMe($event)\"\n        [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-add\" [textContent]=\"text.board_type\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <p [textContent]=\"text.select_board_type\"></p>\n      <section class=\"new-board--section\">\n        <tile-view\n        [tiles]=\"available\"\n        [disable]=\"inFlight\"\n        (create)=\"createBoard($event)\">\n        </tile-view>\n      </section>\n    </div>\n  </div>\n</div>","<div class=\"toolbar-container\">\n  <div class=\"toolbar\">\n    <div class=\"title-container\">\n      <h2 [textContent]=\"text.boards\"></h2>\n    </div>\n    <ul class=\"toolbar-items\"\n        *ngIf=\"showBoardIndexView()\">\n      <li *ngIf=\"canAdd\"\n          class=\"toolbar-item\">\n        <a class=\"button -alt-highlight\"\n           (click)=\"newBoard()\">\n          <op-icon icon-classes=\"button--icon icon-add\">\n          </op-icon>\n          <span class=\"button--text\"\n                [textContent]=\"text.board\">\n          </span>\n        </a>\n      </li>\n    </ul>\n  </div>\n</div>\n\n<div class=\"boards--listing-group loading-indicator--location\"\n     data-indicator-name=\"boards-module\">\n  <div *ngIf=\"showBoardIndexView() && (boards$ | async) as boards\"\n       class=\"generic-table--container\">\n    <div class=\"generic-table--results-container\">\n      <table class=\"generic-table\">\n        <colgroup>\n          <col highlight-col>\n          <col highlight-col>\n          <col highlight-col>\n          <col highlight-col>\n          <col>\n        </colgroup>\n        <thead>\n          <tr>\n            <th>\n              <div class=\"generic-table--sort-header-outer\">\n                <div class=\"generic-table--sort-header\">\n                 <span [textContent]=\"text.name\">\n                 </span>\n                </div>\n              </div>\n            </th>\n            <th>\n              <div class=\"generic-table--sort-header-outer\">\n                <div class=\"generic-table--sort-header\">\n                 <span [textContent]=\"text.type\">\n                 </span>\n                </div>\n              </div>\n            </th>\n            <th>\n              <div class=\"generic-table--sort-header-outer\">\n                <div class=\"generic-table--sort-header\">\n                 <span [textContent]=\"text.createdAt\">\n                 </span>\n                </div>\n              </div>\n            </th>\n            <th>\n              <div class=\"generic-table--empty-header\">\n              </div>\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n        <tr *ngIf=\"boards.length === 0\" id=\"empty-row-notification\">\n          <td colspan=\"4\">\n            <span>\n              <op-icon icon-classes=\"icon-info1 icon-context\"></op-icon>\n              <span>\n                <strong [textContent]=\"text.noResults\"></strong>\n              </span>\n            </span>\n          </td>\n        </tr>\n        <tr *ngFor=\"let board of boards\">\n          <td class=\"name\">\n           <a [textContent]=\"board.name\"\n              uiSref=\"boards.partitioned.show\"\n              [uiParams]=\"{ board_id: board.id }\">\n           </a>\n          </td>\n          <td>\n            <span *ngIf=\"board.isFree\" [textContent]=\"text.type_free\"></span>\n            <span *ngIf=\"board.isAction\" [textContent]=\"text.action_by_attribute(board.actionAttribute)\"></span>\n          </td>\n          <td>\n            <op-date-time [dateTimeValue]=\"board.createdAt\"></op-date-time>\n          </td>\n          <td class=\"buttons\">\n            <accessible-by-keyboard *ngIf=\"board.editable\"\n                                    (execute)=\"destroyBoard(board)\"\n                                    linkClass=\"icon icon-delete\">\n              {{ text.delete }}\n            </accessible-by-keyboard>\n          </td>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n\n<div *ngIf=\"!showBoardIndexView()\"\n     class=\"boards--teaser-container\">\n  <p>{{ text.teaser_text }}</p>\n  <p>{{ text.enterprise }}</p>\n\n  <a class=\"button -alt-highlight -with-icon icon-checkmark\"\n     [href]=\"eeLink()\"\n     target='blank'>\n    {{ text.upgrade }}\n  </a>\n\n  <a class=\"button -highlight-inverted\"\n     [href]=\"demoLink()\" >\n    {{ text.personal_demo }}\n  </a>\n\n  <div class=\"boards--teaser-video-container\">\n    <iframe [src]=\"teaserVideoURL\"\n            class=\"boards--teaser-video\"\n            frameborder=\"0\"\n            allow=\"autoplay; fullscreen\"\n            allowfullscreen>\n    </iframe>\n  </div>\n</div>\n","import {AfterViewInit, Component, Injector, OnInit} from \"@angular/core\";\nimport {Observable} from \"rxjs\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {NewBoardModalComponent} from \"core-app/modules/boards/new-board-modal/new-board-modal.component\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {LoadingIndicatorService} from \"core-app/modules/common/loading-indicator/loading-indicator.service\";\nimport {AuthorisationService} from \"core-app/modules/common/model-auth/model-auth.service\";\nimport {enterpriseDemoUrl, enterpriseEditionUrl} from \"core-app/globals/constants.const\";\nimport {DomSanitizer} from \"@angular/platform-browser\";\nimport {boardTeaserVideoURL} from \"core-app/modules/boards/board-constants.const\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\n@Component({\n  templateUrl: './boards-index-page.component.html',\n  styleUrls: ['./boards-index-page.component.sass']\n})\nexport class BoardsIndexPageComponent extends UntilDestroyedMixin implements OnInit, AfterViewInit {\n\n  public text = {\n    name: this.I18n.t('js.modals.label_name'),\n    board: this.I18n.t('js.label_board'),\n    boards: this.I18n.t('js.label_board_plural'),\n    type: this.I18n.t('js.boards.label_board_type'),\n    type_free: this.I18n.t('js.boards.board_type.free'),\n    action_by_attribute: (attr:string) => this.I18n.t('js.boards.board_type.action_by_attribute',\n      { attribute: this.I18n.t('js.boards.board_type.action_type.' + attr ) }),\n    createdAt: this.I18n.t('js.label_created_on'),\n    delete: this.I18n.t('js.button_delete'),\n    areYouSure: this.I18n.t('js.text_are_you_sure'),\n    deleteSuccessful: this.I18n.t('js.notice_successful_delete'),\n    noResults: this.I18n.t('js.notice_no_results_to_display'),\n\n    teaser_text: this.I18n.t('js.boards.upsale.teaser_text'),\n    enterprise: this.I18n.t('js.boards.upsale.upgrade_to_ee_text'),\n    upgrade: this.I18n.t('js.boards.upsale.upgrade'),\n    personal_demo: this.I18n.t('js.boards.upsale.personal_demo'),\n  };\n\n  public canAdd = false;\n\n  public boards$:Observable<Board[]> = this\n    .apiV3Service\n    .boards\n    .observeAll();\n\n  teaserVideoURL = this.domSanitizer.bypassSecurityTrustResourceUrl(boardTeaserVideoURL);\n\n  constructor(private readonly boardService:BoardService,\n              private readonly apiV3Service:APIV3Service,\n              private readonly I18n:I18nService,\n              private readonly notifications:NotificationsService,\n              private readonly opModalService:OpModalService,\n              private readonly loadingIndicatorService:LoadingIndicatorService,\n              private readonly authorisationService:AuthorisationService,\n              private readonly injector:Injector,\n              private readonly bannerService:BannersService,\n              private readonly domSanitizer:DomSanitizer) {\n    super();\n  }\n\n  ngOnInit():void {\n    this.authorisationService\n      .observeUntil(componentDestroyed(this))\n      .subscribe(() => {\n        this.canAdd = this.authorisationService.can('boards', 'create');\n      });\n  }\n\n  ngAfterViewInit():void {\n    const loadingIndicator = this.loadingIndicatorService.indicator('boards-module');\n    loadingIndicator.promise = this.boardService.loadAllBoards();\n  }\n\n  newBoard() {\n    this.opModalService.show(NewBoardModalComponent, this.injector);\n  }\n\n  destroyBoard(board:Board) {\n    if (!window.confirm(this.text.areYouSure)) {\n      return;\n    }\n\n    this.boardService\n      .delete(board)\n      .then(() => {\n        this.notifications.addSuccess(this.text.deleteSuccessful);\n      })\n      .catch((error) => this.notifications.addError(\"Deletion failed: \" + error));\n  }\n\n  public showBoardIndexView() {\n    return !this.bannerService.eeShowBanners;\n  }\n\n  public eeLink() {\n    return enterpriseEditionUrl + '&op_referrer=boards';\n  }\n\n  public demoLink() {\n    return enterpriseDemoUrl;\n  }\n}\n","export const boardTeaserVideoURL = \"https://player.vimeo.com/video/337280106\";\n","<div class=\"op-modal--portal confirm-form-submit--modal  ngdialog-theme-openproject\">\n  <div class=\"op-modal--modal-container confirm-dialog--modal loading-indicator--location -slim\"\n       data-indicator-name=\"modal\"\n       tabindex=\"0\">\n    <div class=\"op-modal--modal-header\">\n      <a class=\"op-modal--modal-close-button\" *ngIf=\"showClose\">\n        <i\n            class=\"icon-close\"\n            (click)=\"closeMe($event)\"\n            [attr.title]=\"text.close_popup\">\n        </i>\n      </a>\n      <h3 class=\"icon-context icon-add\" [textContent]=\"text.title\"></h3>\n    </div>\n\n    <div class=\"ngdialog-body op-modal--modal-body\">\n      <div *ngIf=\"showWarning && warningText\"\n           class=\"notification-box -warning\">\n        <div class=\"notification-box--content\">\n          <p [innerHTML]=\"warningText\"></p>\n        </div>\n      </div>\n\n        <div class=\"form--field\">\n          <div class=\"form--field-container\">\n            <div class=\"form--select-container\">\n              <label class=\"form--label\" [textContent]=\"actionService.label\"></label>\n              <ndc-dynamic [ndcDynamicComponent]=\"autocompleterComponent()\"\n                           [ndcDynamicInputs]=\"{ availableValues: availableValues,\n                                                 typeahead: requests.input$,\n                                                 appendTo: 'body',\n                                                 model: '',\n                                                 classes: 'new-list--action-select',\n                                                 finishedLoading: true}\"\n                           [ndcDynamicOutputs]=\"referenceOutputs\">\n              </ndc-dynamic>\n            </div>\n          </div>\n        </div>\n\n    </div>\n    <div class=\"op-modal--modal-footer\">\n      <button class=\"button -highlight\"\n              (click)=\"create()\"\n              [disabled]=\"!this.selectedAttribute || inFlight\"\n              [textContent]=\"text.button_add\"\n              [attr.title]=\"text.button_add\">\n      </button>\n      <button class=\"confirm-form-submit--cancel button\"\n              (click)=\"closeMe($event)\"\n              [textContent]=\"text.button_cancel\"\n              [attr.title]=\"text.button_cancel\">\n      </button>\n    </div>\n  </div>\n</div>\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {OpModalComponent} from \"core-components/op-modals/op-modal.component\";\nimport {OpModalLocalsToken} from \"core-components/op-modals/op-modal.service\";\nimport {ChangeDetectorRef, Component, ElementRef, Inject, OnInit} from \"@angular/core\";\nimport {OpModalLocalsMap} from \"core-components/op-modals/op-modal.types\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {StateService} from \"@uirouter/core\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {BoardActionService} from \"core-app/modules/boards/board/board-actions/board-action.service\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {AngularTrackingHelpers} from \"core-components/angular/tracking-functions\";\nimport {CreateAutocompleterComponent} from \"core-app/modules/common/autocomplete/create-autocompleter.component\";\nimport {of} from \"rxjs\";\nimport {DebouncedRequestSwitchmap, errorNotificationHandler} from \"core-app/helpers/rxjs/debounced-input-switchmap\";\nimport {ValueOption} from \"core-app/modules/fields/edit/field-types/select-edit-field.component\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\n\n@Component({\n  templateUrl: './add-list-modal.html'\n})\nexport class AddListModalComponent extends OpModalComponent implements OnInit {\n  /** Keep a switchmap for search term and loading state */\n  public requests = new DebouncedRequestSwitchmap<string, ValueOption>(\n    (searchTerm:string) => this.actionService.loadAvailable(this.board, this.active, searchTerm),\n    errorNotificationHandler(this.halNotification),\n    true\n  );\n\n  public showClose:boolean;\n\n  public confirmed = false;\n\n  /** Active board */\n  public board:Board;\n\n  /** Current active set of values */\n  public active:Set<string>;\n\n  /** Action service used by the board */\n  public actionService:BoardActionService;\n\n  /** The selected attribute */\n  public selectedAttribute:HalResource|undefined;\n\n  /** avoid double click */\n  public inFlight = false;\n\n  public trackByHref = AngularTrackingHelpers.trackByHref;\n\n  /* Do not close on outside click (because the select option are appended to the body */\n  public closeOnOutsideClick = false;\n\n  public warningText:string|undefined;\n\n  public text:any = {\n    title: this.I18n.t('js.boards.add_list'),\n    button_add: this.I18n.t('js.button_add'),\n    button_cancel: this.I18n.t('js.button_cancel'),\n    close_popup: this.I18n.t('js.close_popup_title'),\n\n    free_board: this.I18n.t('js.boards.board_type.free'),\n    free_board_text: this.I18n.t('js.boards.board_type.free_text'),\n\n    action_board: this.I18n.t('js.boards.board_type.action'),\n    action_board_text: this.I18n.t('js.boards.board_type.action_text'),\n    select_attribute: this.I18n.t('js.boards.board_type.select_attribute'),\n    placeholder: this.I18n.t('js.placeholders.selection'),\n  };\n\n  public referenceOutputs = {\n    onCreate: (value:HalResource) => this.onNewActionCreated(value),\n    onOpen: () => this.requests.input$.next(''),\n    onChange: (value:HalResource) => this.onModelChange(value),\n    onAfterViewInit: (component:CreateAutocompleterComponent) => component.focusInputField()\n  };\n\n  /** The loaded available values */\n  availableValues:any;\n\n  /** Whether the no results warning is displayed */\n  showWarning:boolean = false;\n\n  constructor(readonly elementRef:ElementRef,\n              @Inject(OpModalLocalsToken) public locals:OpModalLocalsMap,\n              readonly cdRef:ChangeDetectorRef,\n              readonly boardActions:BoardActionsRegistryService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly state:StateService,\n              readonly boardService:BoardService,\n              readonly I18n:I18nService) {\n\n    super(locals, cdRef, elementRef);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    this.board = this.locals.board;\n    this.active = new Set(this.locals.active as string[]);\n    this.actionService = this.boardActions.get(this.board.actionAttribute!);\n\n\n    this\n      .requests\n      .output$\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((values:unknown[]) => {\n        let hasMember = false;\n        if (values.length === 0) {\n            if (this.requests.lastRequestedValue !== undefined && this.requests.lastRequestedValue !== '') {\n            hasMember = true;\n          }\n          else {\n            hasMember = false;\n          }\n        }\n        else {\n            hasMember = false;\n        }\n        this.actionService\n        .warningTextWhenNoOptionsAvailable(hasMember)\n        .then((text) => {\n          this.warningText = text;\n        });\n        this.availableValues = values;\n        this.showWarning = this.requests.lastRequestedValue !== undefined && (values.length === 0);\n        this.cdRef.detectChanges();\n      });\n\n    // Request an empty value to load warning early on\n    this.requests.input$.next('');\n  }\n\n  onModelChange(element:HalResource) {\n    this.selectedAttribute = element;\n  }\n\n  create() {\n    this.inFlight = true;\n    this.actionService\n      .addColumnWithActionAttribute(this.board, this.selectedAttribute!)\n      .then(board => this.boardService.save(board).toPromise())\n      .then((board) => {\n        this.inFlight = false;\n        this.closeMe();\n        this.state.go('boards.partitioned.show', { board_id: board.id, isNew: true });\n      })\n      .catch(() => this.inFlight = false);\n  }\n\n  onNewActionCreated(newValue:HalResource) {\n    this.selectedAttribute = newValue;\n    this.create();\n  }\n\n  autocompleterComponent() {\n    return this.actionService.autocompleterComponent();\n  }\n}\n\n","//-- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n//++\n\nimport {ChangeDetectorRef, Directive, ElementRef, Injector} from '@angular/core';\nimport {I18nService} from 'core-app/modules/common/i18n/i18n.service';\nimport {AuthorisationService} from 'core-app/modules/common/model-auth/model-auth.service';\nimport {OpContextMenuTrigger} from 'core-components/op-context-menu/handlers/op-context-menu-trigger.directive';\nimport {OPContextMenuService} from 'core-components/op-context-menu/op-context-menu.service';\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {WorkPackageInlineCreateService} from \"core-components/wp-inline-create/wp-inline-create.service\";\nimport {BoardListComponent} from \"core-app/modules/boards/board/board-list/board-list.component\";\n\n@Directive({\n  selector: '[addCardDropdown]'\n})\nexport class AddCardDropdownMenuDirective extends OpContextMenuTrigger {\n\n  private focusAfterClose = true;\n\n  constructor(readonly elementRef:ElementRef,\n              readonly opContextMenu:OPContextMenuService,\n              readonly opModalService:OpModalService,\n              readonly authorisationService:AuthorisationService,\n              readonly wpInlineCreate:WorkPackageInlineCreateService,\n              readonly boardList:BoardListComponent,\n              readonly injector:Injector,\n              readonly querySpace:IsolatedQuerySpace,\n              readonly cdRef:ChangeDetectorRef,\n              readonly I18n:I18nService) {\n\n    super(elementRef, opContextMenu);\n  }\n\n  protected open(evt:JQuery.TriggeredEvent) {\n    this.items = this.buildItems();\n    this.opContextMenu.show(this, evt);\n  }\n\n  /**\n   * Positioning args for jquery-ui position.\n   *\n   * @param {Event} openerEvent\n   */\n  public positionArgs(evt:JQuery.TriggeredEvent) {\n    let additionalPositionArgs = {\n      my: 'left top',\n      at: 'left bottom'\n    };\n\n    let position = super.positionArgs(evt);\n    _.assign(position, additionalPositionArgs);\n\n    return position;\n  }\n\n  private buildItems() {\n    return [\n      {\n        disabled: !this.wpInlineCreate.canAdd,\n        linkText: this.I18n.t('js.card.add_new'),\n        onClick: () => {\n          this.boardList.addNewCard();\n          return true;\n        }\n      },\n      {\n        disabled: !this.wpInlineCreate.canReference,\n        linkText: this.I18n.t('js.relation_buttons.add_existing'),\n        onClick: () => {\n          this.boardList.addReferenceCard();\n          return true;\n        }\n      }\n    ];\n  }\n}\n","import {AfterViewInit, Component, Input} from \"@angular/core\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {CurrentProjectService} from \"core-components/projects/current-project.service\";\nimport {WorkPackageStatesInitializationService} from \"core-components/wp-list/wp-states-initialization.service\";\nimport {IsolatedQuerySpace} from \"core-app/modules/work_packages/query-space/isolated-query-space\";\nimport {HalResourceService} from \"core-app/modules/hal/services/hal-resource.service\";\nimport {WorkPackageViewFiltersService} from \"core-app/modules/work_packages/routing/wp-view-base/view-services/wp-view-filters.service\";\nimport {QueryFilterInstanceResource} from \"core-app/modules/hal/resources/query-filter-instance-resource\";\nimport {UrlParamsHelperService} from \"core-components/wp-query/url-params-helper\";\nimport {StateService} from \"@uirouter/core\";\nimport {debounceTime, skip, take} from \"rxjs/operators\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {Observable} from \"rxjs\";\nimport {BoardFiltersService} from \"core-app/modules/boards/board/board-filter/board-filters.service\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\n@Component({\n  selector: 'board-filter',\n  templateUrl: './board-filter.component.html'\n})\nexport class BoardFilterComponent extends UntilDestroyedMixin implements AfterViewInit {\n  /** Current active */\n  @Input() public board$:Observable<Board>;\n\n  initialized = false;\n\n  constructor(private readonly currentProjectService:CurrentProjectService,\n              private readonly querySpace:IsolatedQuerySpace,\n              private readonly apiV3Service:APIV3Service,\n              private readonly halResourceService:HalResourceService,\n              private readonly wpStatesInitialization:WorkPackageStatesInitializationService,\n              private readonly wpTableFilters:WorkPackageViewFiltersService,\n              private readonly urlParamsHelper:UrlParamsHelperService,\n              private readonly boardFilters:BoardFiltersService,\n              private readonly $state:StateService) {\n    super();\n  }\n\n  ngAfterViewInit():void {\n    if (!this.board$) {\n      return;\n    }\n\n    this.board$\n      .pipe(take(1))\n      .subscribe(board => {\n        // Initially load the form once to be able to render filters\n        this.loadQueryForm();\n\n        // Update checksum service whenever filters change\n        this.updateChecksumOnFilterChanges();\n\n        // Remove action attribute from filter service\n        if (board.isAction) {\n          this.wpTableFilters.hidden.push(board.actionAttribute!);\n        }\n      });\n  }\n\n  private updateChecksumOnFilterChanges() {\n    this.wpTableFilters\n      .live$()\n      .pipe(\n        this.untilDestroyed(),\n        skip(1),\n        debounceTime(250)\n      )\n      .subscribe(() => {\n\n        const filters:QueryFilterInstanceResource[] = this.wpTableFilters.current;\n        let filterHash = this.urlParamsHelper.buildV3GetFilters(filters);\n        let query_props = JSON.stringify(filterHash);\n\n        this.boardFilters.filters.putValue(filterHash);\n\n        this.$state.go('.', { query_props: query_props }, { custom: { notify: false } });\n      });\n  }\n\n  private loadQueryForm() {\n    this\n      .apiV3Service\n      .queries\n      .form\n      .loadWithParams(\n        { filters: JSON.stringify(this.boardFilters.current) },\n        undefined,\n        this.currentProjectService.id\n      )\n      .subscribe(([form, query]) => {\n        this.querySpace.query.putValue(query);\n        this.wpStatesInitialization.updateStatesFromForm(query, form);\n      });\n  }\n}\n","<filter-container></filter-container>\n","import { CdkDrag, DragDropModule } from '@angular/cdk/drag-drop';\nimport { Injectable, ɵɵdefineInjectable, Directive, NgZone, ChangeDetectorRef, Input, NgModule } from '@angular/core';\nimport { BehaviorSubject, Subject, fromEvent } from 'rxjs';\nimport { takeUntil, debounceTime } from 'rxjs/operators';\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\r\nimport * as ɵngcc0 from '@angular/core';\nimport * as ɵngcc1 from '@angular/cdk/drag-drop';\nclass AutoScroll {\r\n    /**\r\n     * @param {?} container\r\n     * @param {?=} scrollCallback\r\n     */\r\n    constructor(container, scrollCallback) {\r\n        this.container = container;\r\n        this.scrollCallback = scrollCallback;\r\n        this.margin = 30;\r\n        this.maxSpeed = 25;\r\n        this.point = { x: 0, y: 0 };\r\n        this.boundaryRect = this.container.getBoundingClientRect();\r\n    }\r\n    /**\r\n     * @param {?} point\r\n     * @return {?}\r\n     */\r\n    onMove(point) {\r\n        this.point = point;\r\n        cancelAnimationFrame(this.animationFrame);\r\n        this.animationFrame = requestAnimationFrame((/**\r\n         * @return {?}\r\n         */\r\n        () => this.scrollTick()));\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    scrollTick() {\r\n        cancelAnimationFrame(this.animationFrame);\r\n        if (this.autoScroll()) {\r\n            this.animationFrame = requestAnimationFrame((/**\r\n             * @return {?}\r\n             */\r\n            () => this.scrollTick()));\r\n        }\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    autoScroll() {\r\n        /** @type {?} */\r\n        let scrollx;\r\n        /** @type {?} */\r\n        let scrolly;\r\n        if (this.point.x < this.boundaryRect.left + this.margin) {\r\n            scrollx = Math.floor(Math.max(-1, (this.point.x - this.boundaryRect.left) / this.margin - 1) * this.maxSpeed);\r\n        }\r\n        else if (this.point.x > this.boundaryRect.right - this.margin) {\r\n            scrollx = Math.ceil(Math.min(1, (this.point.x - this.boundaryRect.right) / this.margin + 1) * this.maxSpeed);\r\n        }\r\n        else {\r\n            scrollx = 0;\r\n        }\r\n        if (this.point.y < this.boundaryRect.top + this.margin) {\r\n            scrolly = Math.floor(Math.max(-1, (this.point.y - this.boundaryRect.top) / this.margin - 1) *\r\n                this.maxSpeed);\r\n        }\r\n        else if (this.point.y > this.boundaryRect.bottom - this.margin) {\r\n            scrolly = Math.ceil(Math.min(1, (this.point.y - this.boundaryRect.bottom) / this.margin + 1) * this.maxSpeed);\r\n        }\r\n        else {\r\n            scrolly = 0;\r\n        }\r\n        setTimeout((/**\r\n         * @return {?}\r\n         */\r\n        () => {\r\n            if (scrolly) {\r\n                this.scrollY(scrolly);\r\n            }\r\n            if (scrollx) {\r\n                this.scrollX(scrollx);\r\n            }\r\n        }));\r\n        return scrollx || scrolly;\r\n    }\r\n    /**\r\n     * @param {?} amount\r\n     * @return {?}\r\n     */\r\n    scrollY(amount) {\r\n        // ToDo for window: window.scrollTo(window.pageXOffset, window.pageYOffset + amount);\r\n        this.container.scrollTop += amount;\r\n        if (this.scrollCallback) {\r\n            this.scrollCallback({ x: 0, y: amount });\r\n        }\r\n    }\r\n    /**\r\n     * @param {?} amount\r\n     * @return {?}\r\n     */\r\n    scrollX(amount) {\r\n        // ToDo for window: window.scrollTo(window.pageXOffset + amount, window.pageYOffset);\r\n        this.container.scrollLeft += amount;\r\n        if (this.scrollCallback) {\r\n            this.scrollCallback({\r\n                x: amount,\r\n                y: 0\r\n            });\r\n        }\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    destroy() {\r\n        cancelAnimationFrame(this.animationFrame);\r\n    }\r\n}\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\r\nclass DragDebugService {\r\n    constructor() {\r\n        this.debugInfo = new BehaviorSubject(null);\r\n        this.enabled = false;\r\n    }\r\n    /**\r\n     * @param {?} info\r\n     * @return {?}\r\n     */\r\n    log(info) {\r\n        this.debugInfo.next(info);\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    reset() {\r\n        this.debugInfo.next(null);\r\n    }\r\n}\nDragDebugService.ɵfac = function DragDebugService_Factory(t) { return new (t || DragDebugService)(); };\nDragDebugService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DragDebugService, factory: DragDebugService.ɵfac, providedIn: 'root' });\r\n/** @nocollapse */\r\nDragDebugService.ctorParameters = () => [];\r\n/** @nocollapse */ DragDebugService.ngInjectableDef = ɵɵdefineInjectable({ factory: function DragDebugService_Factory() { return new DragDebugService(); }, token: DragDebugService, providedIn: \"root\" });\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DragDebugService, [{\n        type: Injectable,\n        args: [{\n                providedIn: 'root'\n            }]\n    }], function () { return []; }, null); })();\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\r\n/**\r\n * @template T\r\n */\r\nclass DragScrollDirective {\r\n    /**\r\n     * @param {?} cdkDrag\r\n     * @param {?} dragDebugService\r\n     * @param {?} zone\r\n     * @param {?} changeDetectorRef\r\n     */\r\n    constructor(cdkDrag, dragDebugService, zone, changeDetectorRef) {\r\n        this.cdkDrag = cdkDrag;\r\n        this.dragDebugService = dragDebugService;\r\n        this.zone = zone;\r\n        this.changeDetectorRef = changeDetectorRef;\r\n        this.destroy$ = new Subject();\r\n        this.stopDragging$ = new Subject();\r\n        this.lastScroll = {\r\n            top: 0,\r\n            left: 0\r\n        };\r\n        this.dragRef = this.cdkDrag['_dragRef'];\r\n        if (this.dragRef) {\r\n            this.zone.runOutsideAngular((/**\r\n             * @return {?}\r\n             */\r\n            () => {\r\n                this.dragRef.started.pipe(takeUntil(this.destroy$)).subscribe((/**\r\n                 * @param {?} event\r\n                 * @return {?}\r\n                 */\r\n                event => {\r\n                    this.log('Started', event, this.dragRef.isDragging());\r\n                    this.started();\r\n                }));\r\n                this.dragRef.ended.pipe(takeUntil(this.destroy$)).subscribe((/**\r\n                 * @param {?} event\r\n                 * @return {?}\r\n                 */\r\n                event => {\r\n                    this.log('Ended', event);\r\n                    this.ended();\r\n                }));\r\n                this.dragRef.entered.pipe(takeUntil(this.destroy$)).subscribe((/**\r\n                 * @param {?} event\r\n                 * @return {?}\r\n                 */\r\n                event => {\r\n                    this.log('Entered', event);\r\n                    this.entered();\r\n                }));\r\n                this.dragRef.exited.pipe(takeUntil(this.destroy$)).subscribe((/**\r\n                 * @param {?} event\r\n                 * @return {?}\r\n                 */\r\n                event => {\r\n                    this.log('Exited', event);\r\n                    this.exited();\r\n                }));\r\n            }));\r\n        }\r\n        else {\r\n            this.log('CdkDrag not found', this.cdkDrag, this.dragRef);\r\n        }\r\n    }\r\n    /**\r\n     * @param {?} changes\r\n     * @return {?}\r\n     */\r\n    ngOnChanges(changes) {\r\n        if (changes.dragConnectedIds) {\r\n            if (this.dragRef.isDragging()) {\r\n                // https://github.com/angular/material2/issues/15343\r\n                setTimeout((/**\r\n                 * @return {?}\r\n                 */\r\n                () => {\r\n                    this.syncSiblings();\r\n                }));\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    ngOnDestroy() {\r\n        this.destroy$.next();\r\n        this.destroy$.complete();\r\n        this.stopDragging$.next();\r\n        this.stopDragging$.complete();\r\n        this.destroyAutoScroll();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    started() {\r\n        if (!this.scrollContainer) {\r\n            return;\r\n        }\r\n        this.destroyAutoScroll();\r\n        this.addDebugInfo();\r\n        this.autoScroll = new AutoScroll(this.scrollContainer);\r\n        this.lastScroll.top = this.scrollContainer.scrollTop;\r\n        this.lastScroll.left = this.scrollContainer.scrollLeft;\r\n        fromEvent(this.scrollContainer, 'scroll')\r\n            .pipe(takeUntil(this.stopDragging$))\r\n            .subscribe((/**\r\n         * @return {?}\r\n         */\r\n        () => {\r\n            /** @type {?} */\r\n            const deltaX = this.scrollContainer.scrollLeft - this.lastScroll.left;\r\n            /** @type {?} */\r\n            const deltaY = this.scrollContainer.scrollTop - this.lastScroll.top;\r\n            if (deltaX || deltaY) {\r\n                this.handleScroll(deltaX, deltaY);\r\n            }\r\n            this.lastScroll.top = this.scrollContainer.scrollTop;\r\n            this.lastScroll.left = this.scrollContainer.scrollLeft;\r\n        }));\r\n        this.dragRef.moved\r\n            .pipe(debounceTime(10), takeUntil(this.stopDragging$))\r\n            .subscribe((/**\r\n         * @param {?} e\r\n         * @return {?}\r\n         */\r\n        e => {\r\n            this.autoScroll.onMove(e.pointerPosition);\r\n        }));\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    ended() {\r\n        this.destroyAutoScroll();\r\n        this.stopDragging$.next();\r\n        this.dragDebugService.reset();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    entered() {\r\n        this.dragFixContainer();\r\n    }\r\n    /**\r\n     * @return {?}\r\n     */\r\n    exited() {\r\n        this.dragFixContainer();\r\n    }\r\n    /**\r\n     * @private\r\n     * @param {?} x\r\n     * @param {?} y\r\n     * @return {?}\r\n     */\r\n    handleScroll(x, y) {\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        // adjust containers\r\n        this.adjustContainers();\r\n        // adjust items\r\n        this.adjustItems(x, y);\r\n        // ToDo: better condition for changed items\r\n        if (dropListRef._draggables.length > dropListRef._itemPositions.length) {\r\n            this.syncItems();\r\n        }\r\n        this.addDebugInfo();\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    destroyAutoScroll() {\r\n        if (this.autoScroll) {\r\n            this.autoScroll.destroy();\r\n            this.autoScroll = null;\r\n        }\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    getDropListRef() {\r\n        return this.dragRef['_dropContainer'];\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    addDebugInfo() {\r\n        if (!this.dragDebugService.enabled) {\r\n            return;\r\n        }\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        /** @type {?} */\r\n        const draws = [\r\n            ...dropListRef._itemPositions.map((/**\r\n             * @param {?} it\r\n             * @return {?}\r\n             */\r\n            it => ({\r\n                clientRect: it.clientRect,\r\n                color: 'blue',\r\n                id: it.drag.data.data.name\r\n            }))),\r\n            ...dropListRef._siblings.map((/**\r\n             * @param {?} it\r\n             * @return {?}\r\n             */\r\n            it => ({\r\n                clientRect: it._clientRect,\r\n                color: 'green',\r\n                id: ''\r\n            }))),\r\n            {\r\n                clientRect: dropListRef._clientRect,\r\n                color: '#2FD1BB',\r\n                id: ''\r\n            }\r\n        ];\r\n        this.dragDebugService.log(draws.filter((/**\r\n         * @param {?} d\r\n         * @return {?}\r\n         */\r\n        d => d.clientRect)));\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    dragFixContainer() {\r\n        // https://github.com/angular/material2/issues/15227\r\n        setTimeout((/**\r\n         * @return {?}\r\n         */\r\n        () => {\r\n            /** @type {?} */\r\n            const dropListRef = this.getDropListRef();\r\n            dropListRef._cacheOwnPosition();\r\n            this.addDebugInfo();\r\n        }));\r\n        // fix for issue when classes is not resetted\r\n        this.changeDetectorRef.markForCheck();\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    syncSiblings() {\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        this.log('syncSiblings before', dropListRef._siblings.length);\r\n        dropListRef.beforeStarted.next();\r\n        this.log('syncSiblings after', dropListRef._siblings.length);\r\n        this.adjustContainers();\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    syncItems() {\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        /** @type {?} */\r\n        const oldPositions = dropListRef._itemPositions;\r\n        dropListRef._activeDraggables = dropListRef._draggables.slice();\r\n        dropListRef._cacheItemPositions();\r\n        /** @type {?} */\r\n        const newPositions = dropListRef._itemPositions;\r\n        dropListRef._itemPositions = [...oldPositions];\r\n        newPositions.forEach((/**\r\n         * @param {?} p\r\n         * @return {?}\r\n         */\r\n        p => {\r\n            if (!oldPositions.find((/**\r\n             * @param {?} p1\r\n             * @return {?}\r\n             */\r\n            p1 => p.drag === p1.drag))) {\r\n                dropListRef._itemPositions.push(p);\r\n            }\r\n        }));\r\n        dropListRef._activeDraggables.push(this.dragRef);\r\n    }\r\n    /**\r\n     * @private\r\n     * @return {?}\r\n     */\r\n    adjustContainers() {\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        dropListRef._cacheOwnPosition();\r\n        dropListRef._siblings.forEach((/**\r\n         * @param {?} sibling\r\n         * @return {?}\r\n         */\r\n        sibling => {\r\n            sibling._cacheOwnPosition();\r\n        }));\r\n    }\r\n    /**\r\n     * @private\r\n     * @param {?} deltaX\r\n     * @param {?} deltaY\r\n     * @return {?}\r\n     */\r\n    adjustItems(deltaX, deltaY) {\r\n        /** @type {?} */\r\n        const dropListRef = this.getDropListRef();\r\n        dropListRef._itemPositions.forEach((/**\r\n         * @param {?} it\r\n         * @return {?}\r\n         */\r\n        it => {\r\n            it.originalRect = it.originalRect || it.clientRect;\r\n            it.clientRect = Object.assign({}, it.clientRect, { left: it.clientRect.left - deltaX, right: it.clientRect.right - deltaX, top: it.clientRect.top - deltaY, bottom: it.clientRect.bottom - deltaY });\r\n        }));\r\n    }\r\n    /**\r\n     * @private\r\n     * @param {?=} message\r\n     * @param {...?} optionalParams\r\n     * @return {?}\r\n     */\r\n    log(message, ...optionalParams) {\r\n        if (this.dragDebugService.enabled) {\r\n            console.log(message, optionalParams);\r\n        }\r\n    }\r\n}\nDragScrollDirective.ɵfac = function DragScrollDirective_Factory(t) { return new (t || DragScrollDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.CdkDrag), ɵngcc0.ɵɵdirectiveInject(DragDebugService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef)); };\nDragScrollDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DragScrollDirective, selectors: [[\"\", \"vsDragScroll\", \"\"]], inputs: { dragConnectedIds: [\"vsDragScrollConnectedTo\", \"dragConnectedIds\"], scrollContainer: [\"vsDragScrollContainer\", \"scrollContainer\"] }, exportAs: [\"vsDragScroll\"], features: [ɵngcc0.ɵɵNgOnChangesFeature] });\r\n/** @nocollapse */\r\nDragScrollDirective.ctorParameters = () => [\r\n    { type: CdkDrag },\r\n    { type: DragDebugService },\r\n    { type: NgZone },\r\n    { type: ChangeDetectorRef }\r\n];\r\nDragScrollDirective.propDecorators = {\r\n    dragConnectedIds: [{ type: Input, args: ['vsDragScrollConnectedTo',] }],\r\n    scrollContainer: [{ type: Input, args: ['vsDragScrollContainer',] }]\r\n};\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DragScrollDirective, [{\n        type: Directive,\n        args: [{\n                selector: '[vsDragScroll]',\n                exportAs: 'vsDragScroll'\n            }]\n    }], function () { return [{ type: ɵngcc1.CdkDrag }, { type: DragDebugService }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.ChangeDetectorRef }]; }, { dragConnectedIds: [{\n            type: Input,\n            args: ['vsDragScrollConnectedTo']\n        }], scrollContainer: [{\n            type: Input,\n            args: ['vsDragScrollContainer']\n        }] }); })();\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\r\nclass DragScrollModule {\r\n}\nDragScrollModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: DragScrollModule });\nDragScrollModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function DragScrollModule_Factory(t) { return new (t || DragScrollModule)(); }, imports: [[DragDropModule]] });\n(function () { (typeof ngJitMode === \"undefined\" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(DragScrollModule, { declarations: function () { return [DragScrollDirective]; }, imports: function () { return [DragDropModule]; }, exports: function () { return [DragScrollDirective]; } }); })();\n/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DragScrollModule, [{\n        type: NgModule,\n        args: [{\n                imports: [DragDropModule],\n                declarations: [DragScrollDirective],\n                exports: [DragScrollDirective]\n            }]\n    }], null, null); })();\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\n/**\r\n * @fileoverview added by tsickle\r\n * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc\r\n */\n\nexport { AutoScroll, DragDebugService, DragScrollDirective, DragScrollModule };\n\n//# sourceMappingURL=cdk-drag-scroll.js.map","import {Component, Input} from \"@angular/core\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {Observable} from \"rxjs\";\n\n@Component({\n  template: `\n    <button title=\"{{ text.button_more }}\"\n            class=\"button last board--settings-dropdown toolbar-icon\"\n            boardsToolbarMenu\n            [boardsToolbarMenu-resource]=\"board$ | async\">\n      <op-icon icon-classes=\"button--icon icon-show-more\"></op-icon>\n    </button>\n  `\n})\nexport class BoardsMenuButtonComponent {\n  @Input() board$:Observable<Board>;\n\n  text = {\n    button_more: this.I18n.t('js.button_more'),\n  };\n\n  constructor(readonly I18n:I18nService) {\n  }\n}","import {Observable, Subject} from \"rxjs\";\nimport {HalResource} from \"core-app/modules/hal/resources/hal-resource\";\nimport {switchMap, takeUntil} from \"rxjs/operators\";\n\nexport type RequestSwitchmapHandler<T, R> = (input:T) => Observable<R>;\n\nexport class RequestSwitchmap<T, R = HalResource> {\n\n  /** Input request state */\n  private requests = new Subject<T>();\n\n  /** Output switchmap observable */\n  private responses$ = this.requests\n    .pipe(\n      // Stream the request, switchMap will result in previous requests to be cancelled\n      switchMap(this.handler)\n    );\n\n  /**\n   *\n   * @param handler switch map handler function to output a response observable\n   */\n  constructor(readonly handler:RequestSwitchmapHandler<T, R>) {\n  }\n\n  /**\n   * Append a new request for the given request value and pass\n   * that to the switchmap handler\n   * @param newValue\n   */\n  public request(newValue:T) {\n    this.requests.next(newValue);\n  }\n\n  /**\n   * Observe the switched response\n   */\n  public observe(until:Observable<unknown>) {\n    return this\n      .responses$\n      .pipe(\n        takeUntil(until)\n      );\n  }\n}\n","import { Subscriber } from '../Subscriber';\nimport { Subscription } from '../Subscription';\nexport function finalize(callback) {\n    return (source) => source.lift(new FinallyOperator(callback));\n}\nclass FinallyOperator {\n    constructor(callback) {\n        this.callback = callback;\n    }\n    call(subscriber, source) {\n        return source.subscribe(new FinallySubscriber(subscriber, this.callback));\n    }\n}\nclass FinallySubscriber extends Subscriber {\n    constructor(destination, callback) {\n        super(destination);\n        this.add(new Subscription(callback));\n    }\n}\n//# sourceMappingURL=finalize.js.map","<div class=\"work-packages-partitioned-query-space--container\"\n      [ngClass]=\"currentPartition\">\n  <div class=\"toolbar-container -editable\">\n    <div class=\"toolbar\">\n      <back-button *ngIf=\"backButtonCallback\"\n                   linkClass=\"back-button\"\n                   [customBackMethod]=\"backButtonCallback\">\n      </back-button>\n\n      <editable-toolbar-title [title]=\"selectedTitle\"\n                              [inFlight]=\"toolbarDisabled\"\n                              [showSaveCondition]=\"showToolbarSaveButton\"\n                              (onSave)=\"changeChangesFromTitle($event)\"\n                              (onEmptySubmit)=\"updateTitleName('')\"\n                              [editable]=\"titleEditingEnabled\">\n      </editable-toolbar-title>\n\n      <ul class=\"toolbar-items hide-when-print\"\n          *ngIf=\"showToolbar\">\n\n        <ng-container *ngFor=\"let definition of toolbarButtonComponents\">\n          <li class=\"toolbar-item\"\n              *ngIf=\"!definition.show || definition.show()\"\n              [ngClass]=\"definition.containerClasses\">\n            <ndc-dynamic [ndcDynamicComponent]=\"definition.component\"\n                         [ndcDynamicInputs]=\"definition.inputs\"\n                         [ndcDynamicInjector]=\"injector\"\n                         [ndcDynamicOutputs]=\"definition.outputs\">\n            </ndc-dynamic>\n          </li>\n        </ng-container>\n      </ul>\n    </div>\n  </div>\n\n  <div class=\"work-packages-partitioned-query-space--filter-area\">\n    <ndc-dynamic [ndcDynamicComponent]=\"filterContainerDefinition.component\"\n                 [ndcDynamicInputs]=\"filterContainerDefinition.inputs\"\n                 [ndcDynamicOutputs]=\"filterContainerDefinition.outputs\"\n                 [ndcDynamicInjector]=\"injector\">\n    </ndc-dynamic>\n  </div>\n\n  <div class=\"work-packages-partitioned-page--content-container\">\n    <!-- Left content view -->\n    <div class=\"work-packages-partitioned-page--content-left loading-indicator--location\"\n         data-indicator-name=\"table\"\n         ui-view=\"content-left\">\n    </div>\n\n    <!-- Right content view -->\n    <div class=\"work-packages-partitioned-page--content-right\"\n         ui-view=\"content-right\"></div>\n  </div>\n</div>\n","import {ChangeDetectionStrategy, ChangeDetectorRef, Component, Injector} from \"@angular/core\";\nimport {\n  DynamicComponentDefinition,\n  ToolbarButtonComponentDefinition,\n  ViewPartitionState\n} from \"core-app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component\";\nimport {StateService, TransitionService} from \"@uirouter/core\";\nimport {BoardFilterComponent} from \"core-app/modules/boards/board/board-filter/board-filter.component\";\nimport {Board} from \"core-app/modules/boards/board/board\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {WorkPackageFilterButtonComponent} from \"core-components/wp-buttons/wp-filter-button/wp-filter-button.component\";\nimport {ZenModeButtonComponent} from \"core-components/wp-buttons/zen-mode-toggle-button/zen-mode-toggle-button.component\";\nimport {BoardsMenuButtonComponent} from \"core-app/modules/boards/board/toolbar-menu/boards-menu-button.component\";\nimport {RequestSwitchmap} from \"core-app/helpers/rxjs/request-switchmap\";\nimport {componentDestroyed} from \"@w11k/ngx-componentdestroyed\";\nimport {finalize, take} from \"rxjs/operators\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {Ng2StateDeclaration} from \"@uirouter/angular\";\nimport {BoardFiltersService} from \"core-app/modules/boards/board/board-filter/board-filters.service\";\nimport {CardViewHandlerRegistry} from \"core-components/wp-card-view/event-handler/card-view-handler-registry\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\nexport function boardCardViewHandlerFactory(injector:Injector) {\n  return new CardViewHandlerRegistry(injector);\n}\n\n@Component({\n  templateUrl: '/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.html',\n  styleUrls: [\n    '/app/modules/work_packages/routing/partitioned-query-space-page/partitioned-query-space-page.component.sass',\n    './board-partitioned-page.component.sass'\n  ],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  providers: [\n    DragAndDropService,\n    BoardFiltersService,\n  ]\n})\nexport class BoardPartitionedPageComponent extends UntilDestroyedMixin {\n\n  text = {\n    button_more: this.I18n.t('js.button_more'),\n    delete: this.I18n.t('js.button_delete'),\n    areYouSure: this.I18n.t('js.text_are_you_sure'),\n    deleteSuccessful: this.I18n.t('js.notice_successful_delete'),\n    updateSuccessful: this.I18n.t('js.notice_successful_update'),\n    unnamedBoard: this.I18n.t('js.boards.label_unnamed_board'),\n    loadingError: 'No such board found',\n    addList: this.I18n.t('js.boards.add_list'),\n    upsaleBoards: this.I18n.t('js.boards.upsale.teaser_text'),\n    upsaleCheckOutLink: this.I18n.t('js.work_packages.table_configuration.upsale.check_out_link'),\n    unnamed_list: this.I18n.t('js.boards.label_unnamed_list'),\n  };\n\n  /** Board observable */\n  board$ = this\n    .apiV3Service\n    .boards\n    .id(this.state.params.board_id.toString())\n    .observe();\n\n  /** Whether this is a new board just created */\n  isNew:boolean = !!this.state.params.isNew;\n\n  /** Whether the board is editable */\n  editable:boolean;\n\n  /** Go back to boards using back-button */\n  backButtonCallback = () => this.state.go('boards');\n\n  /** Current query title to render */\n  selectedTitle?:string;\n  currentQuery:QueryResource|undefined;\n\n  /** Whether we're saving the board */\n  toolbarDisabled:boolean = false;\n\n  /** Do we currently have query props ? */\n  showToolbarSaveButton:boolean;\n\n  /** Listener callbacks */\n  removeTransitionSubscription:Function;\n\n  showToolbar = true;\n\n  /** Whether filtering is allowed */\n  filterAllowed:boolean = true;\n\n  /** We need to pass the correct partition state to the view to manage the grid */\n  currentPartition:ViewPartitionState = '-split';\n\n  /** We need to apply our own board filter component */\n  /** Which filter container component to mount */\n  filterContainerDefinition:DynamicComponentDefinition = {\n    component: BoardFilterComponent,\n    inputs: {\n      board$: this.board$\n    },\n  };\n\n  // We remember when we want to update the board\n  boardSaver = new RequestSwitchmap(\n    (board:Board) => {\n      this.toolbarDisabled = true;\n      return this.Boards\n        .save(board)\n        .pipe(\n          finalize(() => this.toolbarDisabled = false)\n        );\n    }\n  );\n\n  toolbarButtonComponents:ToolbarButtonComponentDefinition[] = [\n    {\n      component: WorkPackageFilterButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: ZenModeButtonComponent,\n      containerClasses: 'hidden-for-mobile'\n    },\n    {\n      component: BoardsMenuButtonComponent,\n      containerClasses: 'hidden-for-mobile',\n      show: () => this.editable,\n      inputs: {\n        board$: this.board$\n      }\n    }\n  ];\n\n  constructor(readonly I18n:I18nService,\n              readonly cdRef:ChangeDetectorRef,\n              readonly $transitions:TransitionService,\n              readonly state:StateService,\n              readonly notifications:NotificationsService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly injector:Injector,\n              readonly apiV3Service:APIV3Service,\n              readonly boardFilters:BoardFiltersService,\n              readonly Boards:BoardService) {\n    super();\n  }\n\n  ngOnInit():void {\n    // Ensure board is being loaded\n    this.Boards.loadAllBoards();\n\n    this.boardSaver\n      .observe(componentDestroyed(this))\n      .subscribe(\n        (board:Board) => {\n          this.notifications.addSuccess(this.text.updateSuccessful);\n        },\n        (error:unknown) => this.halNotification.handleRawError(error)\n      );\n\n    this.removeTransitionSubscription = this.$transitions.onSuccess({}, (transition):any => {\n      const toState = transition.to();\n      const params = transition.params('to');\n\n      this.showToolbarSaveButton = !!params.query_props;\n      this.setPartition(toState);\n      this.cdRef.detectChanges();\n    });\n\n    this.board$\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(board => {\n        let queryProps = this.state.params.query_props;\n        this.editable = board.editable;\n        this.selectedTitle = board.name;\n        this.boardFilters.filters.putValue(queryProps ? JSON.parse(queryProps) : board.filters);\n        this.cdRef.detectChanges();\n      });\n  }\n\n  ngOnDestroy():void {\n    super.ngOnDestroy();\n    this.removeTransitionSubscription();\n  }\n\n  changeChangesFromTitle(newName:string) {\n    this.board$\n      .pipe(take(1))\n      .subscribe(board => {\n        board.name = newName;\n        board.filters = this.boardFilters.current;\n\n        let params = { isNew: false, query_props: null };\n        this.state.go('.', params, { custom: { notify: false } });\n\n        this.boardSaver.request(board);\n      });\n  }\n\n  updateTitleName(val:string) {\n    this.changeChangesFromTitle(val);\n  }\n\n  /** Whether the title can be edited */\n  get titleEditingEnabled():boolean {\n    return this.editable;\n  }\n\n  /**\n   * We need to set the current partition to the grid to ensure\n   * either side gets expanded to full width if we're not in '-split' mode.\n   *\n   * @param state The current or entering state\n   */\n  protected setPartition(state:Ng2StateDeclaration) {\n    this.currentPartition = (state.data && state.data.partition) ? state.data.partition : '-split';\n  }\n}\n","<ng-container *ngIf=\"(board$ | async) as board\">\n  <div class=\"boards-list--container\"\n       [ngClass]=\"{ '-free' : board.isFree }\"\n       #container\n       *ngIf=\"showBoardListView()\"\n       cdkDropList\n       [cdkDropListDisabled]=\"!board.editable\"\n       cdkDropListOrientation=\"horizontal\"\n       (cdkDropListDropped)=\"moveList(board, $event)\"\n  >\n    <div *ngFor=\"let queryWidget of board.queries; trackBy:trackByQueryId\"\n         class=\"boards-list--item\"\n         wp-isolated-query-space\n         cdkDrag\n         vsDragScroll\n         [cdkDragData]=\"queryWidget\"\n         [vsDragScrollContainer]=\"_container\">\n      <span *ngIf=\"board.editable\"\n            class=\"boards-list-item-handle icon icon-drag-handle\"\n            cdkDragHandle></span>\n      <board-list [resource]=\"queryWidget\"\n                  [board]=\"board\"\n                  (onRemove)=\"removeList(board, queryWidget)\">\n      </board-list>\n    </div>\n\n    <div class=\"boards-list--add-item -no-text-select\"\n         *ngIf=\"board.editable\"\n         (click)=\"addList(board)\">\n      <div class=\"boards-list--add-item-text\">\n        <op-icon icon-classes=\"icon-add icon-context\"></op-icon>\n        <span [textContent]=\"text.addList\"></span>\n      </div>\n    </div>\n  </div>\n\n  <enterprise-banner *ngIf=\"!showBoardListView()\"\n                     [leftMargin]=\"true\"\n                     [linkMessage]=\"text.upsaleCheckOutLink\"\n                     [textMessage]=\"text.upsaleBoards\"\n                     [opReferrer]=\"opReferrer(board)\">\n  </enterprise-banner>\n</ng-container>","import {Component, ElementRef, Injector, OnInit, QueryList, ViewChild, ViewChildren} from \"@angular/core\";\nimport {Observable, Subscription} from \"rxjs\";\nimport {QueryResource} from \"core-app/modules/hal/resources/query-resource\";\nimport {BoardListComponent} from \"core-app/modules/boards/board/board-list/board-list.component\";\nimport {StateService} from \"@uirouter/core\";\nimport {NotificationsService} from \"core-app/modules/common/notifications/notifications.service\";\nimport {HalResourceNotificationService} from \"core-app/modules/hal/services/hal-resource-notification.service\";\nimport {BoardListsService} from \"core-app/modules/boards/board/board-list/board-lists.service\";\nimport {OpModalService} from \"core-components/op-modals/op-modal.service\";\nimport {BoardService} from \"core-app/modules/boards/board/board.service\";\nimport {BannersService} from \"core-app/modules/common/enterprise/banners.service\";\nimport {DragAndDropService} from \"core-app/modules/common/drag-and-drop/drag-and-drop.service\";\nimport {QueryUpdatedService} from \"core-app/modules/boards/board/query-updated/query-updated.service\";\nimport {UntilDestroyedMixin} from \"core-app/helpers/angular/until-destroyed.mixin\";\nimport {Board, BoardWidgetOption} from \"core-app/modules/boards/board/board\";\nimport {CdkDragDrop, moveItemInArray} from \"@angular/cdk/drag-drop\";\nimport {GridWidgetResource} from \"core-app/modules/hal/resources/grid-widget-resource\";\nimport {BoardPartitionedPageComponent} from \"core-app/modules/boards/board/board-partitioned-page/board-partitioned-page.component\";\nimport {AddListModalComponent} from \"core-app/modules/boards/board/add-list-modal/add-list-modal.component\";\nimport {I18nService} from \"core-app/modules/common/i18n/i18n.service\";\nimport {BoardListCrossSelectionService} from \"core-app/modules/boards/board/board-list/board-list-cross-selection.service\";\nimport {filter} from \"rxjs/operators\";\nimport {BoardActionsRegistryService} from \"core-app/modules/boards/board/board-actions/board-actions-registry.service\";\nimport {APIV3Service} from \"core-app/modules/apiv3/api-v3.service\";\n\n@Component({\n  templateUrl: './board-list-container.component.html',\n  styleUrls: ['./board-list-container.component.sass'],\n  providers: [\n    BoardListCrossSelectionService\n  ]\n})\nexport class BoardListContainerComponent extends UntilDestroyedMixin implements OnInit {\n\n  text = {\n    button_more: this.I18n.t('js.button_more'),\n    delete: this.I18n.t('js.button_delete'),\n    areYouSure: this.I18n.t('js.text_are_you_sure'),\n    deleteSuccessful: this.I18n.t('js.notice_successful_delete'),\n    updateSuccessful: this.I18n.t('js.notice_successful_update'),\n    loadingError: 'No such board found',\n    addList: this.I18n.t('js.boards.add_list'),\n    upsaleBoards: this.I18n.t('js.boards.upsale.teaser_text'),\n    upsaleCheckOutLink: this.I18n.t('js.work_packages.table_configuration.upsale.check_out_link'),\n    unnamed_list: this.I18n.t('js.boards.label_unnamed_list'),\n  };\n\n\n  /** Container reference */\n  public _container:HTMLElement;\n  @ViewChild('container')\n  set container(v:ElementRef|undefined) {\n    // ViewChild reference may be undefined initially\n    // due to ngIf\n    if (v !== undefined) {\n      if (this._container === undefined) {\n        this.Drag.addScrollContainer(v.nativeElement);\n      }\n      setTimeout(() => this._container = v.nativeElement);\n    }\n  }\n\n  /** Reference all query children to extract current actions */\n  @ViewChildren(BoardListComponent) lists:QueryList<BoardListComponent>;\n\n  trackByQueryId = (index:number, widget:GridWidgetResource) => widget.options.queryId;\n\n  board$:Observable<Board>;\n\n  private currentQueryUpdatedMonitoring:Subscription;\n\n  constructor(readonly I18n:I18nService,\n              readonly state:StateService,\n              readonly notifications:NotificationsService,\n              readonly halNotification:HalResourceNotificationService,\n              readonly boardComponent:BoardPartitionedPageComponent,\n              readonly BoardList:BoardListsService,\n              readonly boardActionRegistry:BoardActionsRegistryService,\n              readonly opModalService:OpModalService,\n              readonly injector:Injector,\n              readonly apiV3Service:APIV3Service,\n              readonly Boards:BoardService,\n              readonly Banner:BannersService,\n              readonly boardListCrossSelectionService:BoardListCrossSelectionService,\n              readonly Drag:DragAndDropService,\n              readonly QueryUpdated:QueryUpdatedService) {\n    super();\n  }\n\n  ngOnInit():void {\n    const id:string = this.state.params.board_id.toString();\n\n    this.board$ = this\n      .apiV3Service\n      .boards\n      .id(id)\n      .requireAndStream();\n\n    this.Boards.currentBoard$.next(id);\n\n    this.board$\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe(board => {\n        this.setupQueryUpdatedMonitoring(board);\n      });\n\n    this.boardListCrossSelectionService\n      .selections()\n      .pipe(\n        this.untilDestroyed(),\n        filter((state) => state.focusedWorkPackage !== null),\n        filter(() => this.state.includes(this.state.current.data.baseRoute + '.details'))\n      ).subscribe(selection => {\n      // Update split screen\n      this.state.go(this.state.current.data.baseRoute + '.details', { workPackageId: selection.focusedWorkPackage });\n    });\n  }\n\n  moveList(board:Board, event:CdkDragDrop<GridWidgetResource[]>) {\n    moveItemInArray(board.queries, event.previousIndex, event.currentIndex);\n    this.saveBoard(board);\n  }\n\n  removeList(board:Board, query:GridWidgetResource) {\n    board.removeQuery(query);\n    this.saveBoard(board);\n  }\n\n  addList(board:Board):any {\n    if (board.isFree) {\n      return this.BoardList\n        .addFreeQuery(board, { name: this.text.unnamed_list })\n        .then(board => this.Boards.save(board).toPromise())\n        .catch(error => this.showError(error));\n    } else {\n      const active = this.getActionFiltersFromWidget(board);\n      this.opModalService.show(\n        AddListModalComponent,\n        this.injector,\n        { board: board, active: active }\n      );\n    }\n  }\n\n  showBoardListView() {\n    return !this.Banner.eeShowBanners;\n  }\n\n  opReferrer(board:Board) {\n    return board.isFree ? 'boards#free' : 'boards#status';\n  }\n\n  saveBoard(board:Board):void {\n    this.boardComponent.boardSaver.request(board);\n  }\n\n  private setupQueryUpdatedMonitoring(board:Board) {\n    if (this.currentQueryUpdatedMonitoring) {\n      this.currentQueryUpdatedMonitoring.unsubscribe();\n    }\n\n    this.currentQueryUpdatedMonitoring = this\n      .QueryUpdated\n      .monitor(board.queries.map((widget) => widget.options.queryId as string))\n      .pipe(\n        this.untilDestroyed()\n      )\n      .subscribe((collection) => this.requestRefreshOfUpdatedLists(collection.elements));\n  }\n\n  private showError(text = this.text.loadingError) {\n    this.notifications.addError(text);\n  }\n\n  private requestRefreshOfUpdatedLists(queries:QueryResource[]) {\n    queries.forEach((query) => {\n      this\n        .lists\n        .filter((listComponent) => {\n          const id = query.id!.toString();\n          const listId = (listComponent.resource.options.queryId as string|number).toString();\n\n          return id === listId;\n        })\n        .forEach((listComponent) => listComponent.refreshQueryUnlessCaused(query, false));\n    });\n  }\n\n  /**\n   * Returns the current filter values for an action board.\n   * By extracting them from the widget options, we can avoid waiting for the queries\n   * to be loaded for each list\n   *\n   * @param board\n   */\n  private getActionFiltersFromWidget(board:Board):(string|null)[] {\n    return board.grid.widgets\n      .map(widget => {\n        const service = this.boardActionRegistry.get(board.actionAttribute!);\n        const filterName = service.filterName;\n        const options:BoardWidgetOption = widget.options as any;\n        const filter = _.find(options.filters, (filter) => !!filter[filterName]);\n\n        if (filter) {\n          return (filter[filterName].values[0] || null) as any;\n        }\n      })\n      .filter(value => value !== undefined);\n  }\n\n}","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {Ng2StateDeclaration, UIRouter} from \"@uirouter/angular\";\nimport {BoardsRootComponent} from \"core-app/modules/boards/boards-root/boards-root.component\";\nimport {BoardsIndexPageComponent} from \"core-app/modules/boards/index-page/boards-index-page.component\";\nimport {BoardPartitionedPageComponent} from \"core-app/modules/boards/board/board-partitioned-page/board-partitioned-page.component\";\nimport {BoardListContainerComponent} from \"core-app/modules/boards/board/board-partitioned-page/board-list-container.component\";\nimport {makeSplitViewRoutes} from \"core-app/modules/work_packages/routing/split-view-routes.template\";\nimport {WorkPackageSplitViewComponent} from \"core-app/modules/work_packages/routing/wp-split-view/wp-split-view.component\";\n\nexport const menuItemClass = 'board-view-menu-item';\n\nexport const BOARDS_ROUTES:Ng2StateDeclaration[] = [\n  {\n    name: 'boards',\n    parent: 'root',\n    // The trailing slash is important\n    // cf., https://community.openproject.com/wp/29754\n    url: '/boards/?query_props',\n    data: {\n      bodyClasses: 'router--boards-view-base',\n      menuItem: menuItemClass\n    },\n    params: {\n      // Use custom encoder/decoder that ensures validity of URL string\n      query_props: { type: 'opQueryString', dynamic: true }\n    },\n    redirectTo: 'boards.list',\n    component: BoardsRootComponent\n  },\n  {\n    name: 'boards.list',\n    component: BoardsIndexPageComponent,\n    data: {\n      parent: 'boards',\n      bodyClasses: 'router--boards-list-view',\n      menuItem: menuItemClass\n    }\n  },\n  {\n    name: 'boards.partitioned',\n    url: '{board_id}',\n    params: {\n      board_id: { type: 'int' },\n      isNew: { type: 'bool', inherit: false, dynamic: true }\n    },\n    data: {\n      parent: 'boards',\n      bodyClasses: 'router--boards-full-view',\n      menuItem: menuItemClass\n    },\n    reloadOnSearch: false,\n    component: BoardPartitionedPageComponent,\n    redirectTo: 'boards.partitioned.show',\n  },\n  {\n    name: 'boards.partitioned.show',\n    url: '',\n    data: {\n      baseRoute: 'boards.partitioned.show'\n    },\n    views: {\n      'content-left': { component: BoardListContainerComponent }\n    }\n  },\n  ...makeSplitViewRoutes(\n    'boards.partitioned.show',\n    menuItemClass,\n    WorkPackageSplitViewComponent\n  )\n];\n\nexport function uiRouterBoardsConfiguration(uiRouter:UIRouter) {\n  // Ensure boards/ are being redirected correctly\n  // cf., https://community.openproject.com/wp/29754\n  uiRouter.urlService.rules\n    .when(\n      new RegExp(\"^/projects/(.*)/boards$\"),\n      match => `/projects/${match[1]}/boards/`\n    );\n}\n","// -- copyright\n// OpenProject is an open source project management software.\n// Copyright (C) 2012-2020 the OpenProject GmbH\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License version 3.\n//\n// OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:\n// Copyright (C) 2006-2013 Jean-Philippe Lang\n// Copyright (C) 2010-2013 the ChiliProject Team\n//\n// This program is free software; you can redistribute it and/or\n// modify it under the terms of the GNU General Public License\n// as published by the Free Software Foundation; either version 2\n// of the License, or (at your option) any later version.\n//\n// This program is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with this program; if not, write to the Free Software\n// Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n//\n// See docs/COPYRIGHT.rdoc for more details.\n// ++\n\nimport {NgModule} from '@angular/core';\nimport {OpenprojectCommonModule} from \"core-app/modules/common/openproject-common.module\";\nimport {OpenprojectWorkPackagesModule} from \"core-app/modules/work_packages/openproject-work-packages.module\";\nimport {UIRouterModule} from \"@uirouter/angular\";\nimport {BoardListComponent} from \"core-app/modules/boards/board/board-list/board-list.component\";\nimport {BoardsRootComponent} from \"core-app/modules/boards/boards-root/boards-root.component\";\nimport {BoardInlineAddAutocompleterComponent} from \"core-app/modules/boards/board/inline-add/board-inline-add-autocompleter.component\";\nimport {BoardsToolbarMenuDirective} from \"core-app/modules/boards/board/toolbar-menu/boards-toolbar-menu.directive\";\nimport {BoardConfigurationModal} from \"core-app/modules/boards/board/configuration-modal/board-configuration.modal\";\nimport {BoardsIndexPageComponent} from \"core-app/modules/boards/index-page/boards-index-page.component\";\nimport {BoardsMenuComponent} from \"core-app/modules/boards/boards-sidebar/boards-menu.component\";\nimport {NewBoardModalComponent} from \"core-app/modules/boards/new-board-modal/new-board-modal.component\";\nimport {AddListModalComponent} from \"core-app/modules/boards/board/add-list-modal/add-list-modal.component\";\nimport {BoardHighlightingTabComponent} from \"core-app/modules/boards/board/configuration-modal/tabs/highlighting-tab.component\";\nimport {AddCardDropdownMenuDirective} from \"core-app/modules/boards/board/add-card-dropdown/add-card-dropdown-menu.directive\";\nimport {BoardFilterComponent} from \"core-app/modules/boards/board/board-filter/board-filter.component\";\nimport {DragScrollModule} from \"cdk-drag-scroll\";\nimport {BoardListMenuComponent} from \"core-app/modules/boards/board/board-list/board-list-menu.component\";\nimport {VersionBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/version/version-board-header.component\";\nimport {DynamicModule} from \"ng-dynamic-component\";\nimport {BOARDS_ROUTES, uiRouterBoardsConfiguration} from \"core-app/modules/boards/openproject-boards.routes\";\nimport {BoardPartitionedPageComponent} from \"core-app/modules/boards/board/board-partitioned-page/board-partitioned-page.component\";\nimport {BoardListContainerComponent} from \"core-app/modules/boards/board/board-partitioned-page/board-list-container.component\";\nimport {BoardsMenuButtonComponent} from \"core-app/modules/boards/board/toolbar-menu/boards-menu-button.component\";\nimport {AssigneeBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/assignee/assignee-board-header.component\";\nimport { TileViewComponent } from './tile-view/tile-view.component';\nimport {SubprojectBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/subproject/subproject-board-header.component\";\nimport {SubtasksBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/subtasks/subtasks-board-header.component\";\nimport {StatusBoardHeaderComponent} from \"core-app/modules/boards/board/board-actions/status/status-board-header.component\";\n\n@NgModule({\n  imports: [\n    OpenprojectCommonModule,\n    OpenprojectWorkPackagesModule,\n    DragScrollModule,\n\n    // Dynamic Module for actions\n    DynamicModule.withComponents([VersionBoardHeaderComponent]),\n\n    // Routes for /boards\n    UIRouterModule.forChild({\n      states: BOARDS_ROUTES,\n      config: uiRouterBoardsConfiguration\n    }),\n  ],\n  declarations: [\n    BoardsIndexPageComponent,\n    BoardPartitionedPageComponent,\n    BoardListContainerComponent,\n    BoardListComponent,\n    BoardsRootComponent,\n    BoardInlineAddAutocompleterComponent,\n    BoardsMenuComponent,\n    BoardHighlightingTabComponent,\n    BoardConfigurationModal,\n    BoardsToolbarMenuDirective,\n    BoardsMenuButtonComponent,\n    NewBoardModalComponent,\n    AddListModalComponent,\n    AddCardDropdownMenuDirective,\n    BoardListMenuComponent,\n    BoardFilterComponent,\n    VersionBoardHeaderComponent,\n    AssigneeBoardHeaderComponent,\n    SubprojectBoardHeaderComponent,\n    SubtasksBoardHeaderComponent,\n    StatusBoardHeaderComponent,\n    TileViewComponent,\n  ]\n})\nexport class OpenprojectBoardsModule {\n}\n\n"],"sourceRoot":"webpack:///"}